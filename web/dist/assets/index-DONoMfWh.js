const __vite__fileDeps=["assets/index-YKtimYAl.js","assets/react-core-CLwr57uy.js","assets/semi-ui-Dcxzo4Qw.js","assets/semi-ui-Bs66SFli.css","assets/tools-B1TmcgKL.js","assets/react-components-CR2YBNem.js","assets/semantic-C63L1wvK.js","assets/index-BMU-KYoI.js","assets/visactor-gtn3WK9d.js","assets/index-CElmcdrh.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as t,a as Ct,u as Pe,N as ft,L as iu,R as ou,e as Ru,c as jt,g as yt,f as Dt,h as Bt,i as At,j as me,B as bt}from"./react-core-CLwr57uy.js";import{S as De,T as _e,e as _,f as cu,g as eu,h as de,B as k,F as se,i as ee,j as Te,D as Eu,M as fe,k as L,l as uu,m as Oe,P as ve,L as re,I as Zu,C as be,n as Cu,o as St,R as pe,p as ie,q as Xe,r as ku,A as Ou,s as We,t as wt,u as vt,v as kt,w as bu,x as _u,y as Tu,z as Xu,E as He,G as et,H as _t,J as Iu,K as ut,N as Nu,O as Tt,Q as It,U as Ye,V as Pt,W as tt,X as nt,Y as $t,Z as Mt,$ as Rt,a0 as Ot,a1 as zt,a2 as Lt,a3 as Nt,a4 as Ut,a5 as Wt,a6 as Gt}from"./semi-ui-Dcxzo4Qw.js";import{c as Ht,a as qt}from"./tools-B1TmcgKL.js";import{Q as Kt,_ as au,T as st,f as Su,k as Vt}from"./react-components-CR2YBNem.js";import{G as qe,H as ye,I as zu,F as K,S as yu,B as Ze,M as fu,D as Se,a as mu,b as Qt,L as Jt}from"./semantic-C63L1wvK.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&s(p)}).observe(document,{childList:!0,subtree:!0});function c(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=c(i);fetch(i.href,r)}})();var at={exports:{}},Du={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yt=t,Zt=Symbol.for("react.element"),Xt=Symbol.for("react.fragment"),en=Object.prototype.hasOwnProperty,un=Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tn={key:!0,ref:!0,__self:!0,__source:!0};function rt(u,n,c){var s,i={},r=null,p=null;c!==void 0&&(r=""+c),n.key!==void 0&&(r=""+n.key),n.ref!==void 0&&(p=n.ref);for(s in n)en.call(n,s)&&!tn.hasOwnProperty(s)&&(i[s]=n[s]);if(u&&u.defaultProps)for(s in n=u.defaultProps,n)i[s]===void 0&&(i[s]=n[s]);return{$$typeof:Zt,type:u,key:r,ref:p,props:i,_owner:un.current}}Du.Fragment=Xt;Du.jsx=rt;Du.jsxs=rt;at.exports=Du;var e=at.exports,Pu={},Uu=Ct;Pu.createRoot=Uu.createRoot,Pu.hydrateRoot=Uu.hydrateRoot;const nn="modulepreload",sn=function(u){return"/"+u},Wu={},Lu=function(n,c,s){let i=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),p=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.all(c.map(C=>{if(C=sn(C),C in Wu)return;Wu[C]=!0;const A=C.endsWith(".css"),o=A?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${C}"]${o}`))return;const F=document.createElement("link");if(F.rel=A?"stylesheet":nn,A||(F.as="script",F.crossOrigin=""),F.href=C,p&&F.setAttribute("nonce",p),document.head.appendChild(F),A)return new Promise((l,g)=>{F.addEventListener("load",l),F.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${C}`)))})}))}return i.then(()=>n()).catch(r=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=r,window.dispatchEvent(p),!p.defaultPrevented)throw r})},je=({prompt:u="page"})=>e.jsxs(De,{style:{height:100},spinning:!0,children:["加载",u,"中..."]}),an=Ht(),he=10,xu=[{key:1,text:"OpenAI",value:1,color:"green",label:"OpenAI"},{key:2,text:"Midjourney Proxy",value:2,color:"light-blue",label:"Midjourney Proxy"},{key:5,text:"Midjourney Proxy Plus",value:5,color:"blue",label:"Midjourney Proxy Plus"},{key:4,text:"Ollama",value:4,color:"grey",label:"Ollama"},{key:14,text:"Anthropic Claude",value:14,color:"indigo",label:"Anthropic Claude"},{key:33,text:"AWS Claude",value:33,color:"indigo",label:"AWS Claude"},{key:3,text:"Azure OpenAI",value:3,color:"teal",label:"Azure OpenAI"},{key:11,text:"Google PaLM2",value:11,color:"orange",label:"Google PaLM2"},{key:24,text:"Google Gemini",value:24,color:"orange",label:"Google Gemini"},{key:34,text:"Cohere",value:34,color:"purple",label:"Cohere"},{key:15,text:"百度文心千帆",value:15,color:"blue",label:"百度文心千帆"},{key:17,text:"阿里通义千问",value:17,color:"orange",label:"阿里通义千问"},{key:18,text:"讯飞星火认知",value:18,color:"blue",label:"讯飞星火认知"},{key:16,text:"智谱 ChatGLM",value:16,color:"violet",label:"智谱 ChatGLM"},{key:26,text:"智谱 GLM-4V",value:26,color:"purple",label:"智谱 GLM-4V"},{key:25,text:"Moonshot",value:25,color:"green",label:"Moonshot"},{key:19,text:"360 智脑",value:19,color:"blue",label:"360 智脑"},{key:23,text:"腾讯混元",value:23,color:"teal",label:"腾讯混元"},{key:31,text:"零一万物",value:31,color:"green",label:"零一万物"},{key:8,text:"自定义渠道",value:8,color:"pink",label:"自定义渠道"},{key:22,text:"知识库：FastGPT",value:22,color:"blue",label:"知识库：FastGPT"},{key:21,text:"知识库：AI Proxy",value:21,color:"purple",label:"知识库：AI Proxy"}],rn=({htmlContent:u})=>e.jsx("div",{dangerouslySetInnerHTML:{__html:u}});function Ie(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=10):!1}function it(){let u=localStorage.getItem("user");return u?(u=JSON.parse(u),u.role>=100):!1}function Bu(){let u=localStorage.getItem("system_name");return u||"New API"}function du(){let u=localStorage.getItem("logo");return u||"/logo.png"}function ln(){return localStorage.getItem("footer_html")}async function ze(u){let n=!0;try{await navigator.clipboard.writeText(u)}catch(c){n=!1,console.error(c)}return n}function we(){return window.innerWidth<=600}let lt={autoClose:!1};we()&&(lt.position="top-center");function f(u){if(console.error(u),u.message){if(u.name==="AxiosError"){switch(u.response.status){case 401:window.location.href="/login?expired=true";break;case 429:_e.error("错误：请求次数过多，请稍后再试！");break;case 500:_e.error("错误：服务器内部错误，请联系管理员！");break;case 405:_e.info("本站仅作演示之用，无服务端！");break;default:_e.error("错误："+u.message)}return}_e.error("错误："+u.message)}else _e.error("错误："+u)}function Ke(u){_e.warning(u)}function Y(u){_e.success(u)}function Be(u){_e.info(u)}function Gu(u,n=!1){n?Kt(e.jsx(rn,{htmlContent:u}),lt):_e.info(u)}function wu(u){return u.endsWith("/")?u.slice(0,-1):u}function Le(u){let n=new Date(u*1e3),c=n.getFullYear().toString(),s=(n.getMonth()+1).toString(),i=n.getDate().toString(),r=n.getHours().toString(),p=n.getMinutes().toString(),C=n.getSeconds().toString();return s.length===1&&(s="0"+s),i.length===1&&(i="0"+i),r.length===1&&(r="0"+r),p.length===1&&(p="0"+p),C.length===1&&(C="0"+C),c+"-"+s+"-"+i+" "+r+":"+p+":"+C}function qs(u,n="hour"){let c=new Date(u*1e3),s=(c.getMonth()+1).toString(),i=c.getDate().toString(),r=c.getHours().toString();s.length===1&&(s="0"+s),i.length===1&&(i="0"+i),r.length===1&&(r="0"+r);let p=s+"-"+i;if(n==="hour")p+=" "+r+":00";else if(n==="week"){let C=new Date(u*1e3+5184e5),A=(C.getMonth()+1).toString(),o=C.getDate().toString();A.length===1&&(A="0"+A),o.length===1&&(o="0"+o),p+=" - "+A+"-"+o}return p}function on(u,n){let c=new Blob([u],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(c),i=document.createElement("a");i.href=s,i.download=n,i.click()}const su=u=>{try{JSON.parse(u)}catch{return!1}return!0};function cn(u){return!localStorage.getItem(`prompt-${u}`)}function Ve(u,n){const c=[];for(const s in u)u.hasOwnProperty(s)&&n.hasOwnProperty(s)&&u[s]!==n[s]&&c.push({key:s,oldValue:u[s],newValue:n[s]});return c}var Hu={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const $=qt.create({baseURL:Hu.VITE_REACT_APP_SERVER_URL?Hu.VITE_REACT_APP_SERVER_URL:""});$.interceptors.response.use(u=>u,u=>{f(u)});function ot(u){if(u==="")return e.jsx(_,{size:"large",children:"unknown"},"default");const n={vip:"yellow",pro:"yellow",svip:"red",premium:"red"},c=u.split(",").sort();return e.jsx("span",{children:c.map(s=>e.jsx(_,{size:"large",color:n[s]||ru(s),children:s},s))},u)}function ju(u){return u>=1e9?(u/1e9).toFixed(1)+"B":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e4?(u/1e3).toFixed(1)+"k":u}function Ks(u,n=2){let c=localStorage.getItem("display_in_currency");return u=u.toFixed(n),c?"$"+u:u}function dn(u){if(u=u.toFixed(2),u>=1e5){let n=u.toString(),c=n.indexOf("."),s=n,i="";return c!==-1&&(s=n.slice(0,c),i=n.slice(c)),s.slice(0,2)+".."+s.slice(-2)+i}return u}function gu(){let u=localStorage.getItem("quota_per_unit");return u=parseFloat(u),u}function hn(u){let n=localStorage.getItem("quota_per_unit");return n=parseFloat(n),u=parseFloat(u),n*u}function Vs(u,n=6){let c=localStorage.getItem("quota_per_unit");return c=parseFloat(c),(u/c).toFixed(n)}function Fn(u){let n=localStorage.getItem("display_in_currency");return n=n==="true",n?"$"+u:hn(u)}function ge(u,n=2){let c=localStorage.getItem("quota_per_unit"),s=localStorage.getItem("display_in_currency");return c=parseFloat(c),s=s==="true",s?"$"+(u/c).toFixed(n):ju(u)}function pn(u,n,c,s=-1,i,r){if(s!==-1)return"模型价格：$"+s*r;{i===void 0&&(i=0);let p=c*2*r,C=c*i*2*r,A=u/1e6*p+n/1e6*C;return e.jsx(e.Fragment,{children:e.jsxs("article",{children:[e.jsxs("p",{children:["提示 $",p," / 1M tokens"]}),e.jsxs("p",{children:["补全 $",C," / 1M tokens"]}),e.jsx("p",{}),e.jsxs("p",{children:["提示 ",u," tokens / 1M tokens * $",p," + 补全"," ",n," tokens / 1M tokens * $",C," = $",A.toFixed(6)]})]})})}}function lu(u,n){let c=localStorage.getItem("display_in_currency");return c=c==="true",c?`（等价金额：${ge(u,n)}）`:""}const qu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"],Qs={"dall-e":"rgb(147,112,219)","dall-e-3":"rgb(153,50,204)","gpt-3.5-turbo":"rgb(184,227,167)","gpt-3.5-turbo-0613":"rgb(60,179,113)","gpt-3.5-turbo-1106":"rgb(32,178,170)","gpt-3.5-turbo-16k":"rgb(149,252,206)","gpt-3.5-turbo-16k-0613":"rgb(119,255,214)","gpt-3.5-turbo-instruct":"rgb(175,238,238)","gpt-4":"rgb(135,206,235)","gpt-4-0613":"rgb(100,149,237)","gpt-4-1106-preview":"rgb(30,144,255)","gpt-4-0125-preview":"rgb(2,177,236)","gpt-4-turbo-preview":"rgb(2,177,255)","gpt-4-32k":"rgb(104,111,238)","gpt-4-32k-0613":"rgb(61,71,139)","gpt-4-all":"rgb(65,105,225)","gpt-4-gizmo-*":"rgb(0,0,255)","gpt-4-vision-preview":"rgb(25,25,112)","text-ada-001":"rgb(255,192,203)","text-babbage-001":"rgb(255,160,122)","text-curie-001":"rgb(219,112,147)","text-davinci-003":"rgb(219,112,147)","text-davinci-edit-001":"rgb(255,105,180)","text-embedding-ada-002":"rgb(255,182,193)","text-embedding-v1":"rgb(255,174,185)","text-moderation-latest":"rgb(255,130,171)","text-moderation-stable":"rgb(255,160,122)","tts-1":"rgb(255,140,0)","tts-1-1106":"rgb(255,165,0)","tts-1-hd":"rgb(255,215,0)","tts-1-hd-1106":"rgb(255,223,0)","whisper-1":"rgb(245,245,220)","claude-3-opus-20240229":"rgb(255,132,31)","claude-3-sonnet-20240229":"rgb(253,135,93)","claude-3-haiku-20240307":"rgb(255,175,146)","claude-2.1":"rgb(255,209,190)"};function ru(u){let n=0;for(let s=0;s<u.length;s++)n+=u.charCodeAt(s);let c=n%qu.length;return qu[c]}const mn=u=>{const n={username:"",display_name:"",password:""},[c,s]=t.useState(n),[i,r]=t.useState(!1),{username:p,display_name:C,password:A}=c,o=(g,w)=>{s(O=>({...O,[g]:w}))},F=async()=>{if(r(!0),c.username===""||c.password==="")return;const g=await $.post("/api/user/",c),{success:w,message:O}=g.data;w?(Y("用户账户创建成功！"),s(n),u.refresh(),u.handleClose()):f(O),r(!1)},l=()=>{u.handleClose()};return e.jsx(e.Fragment,{children:e.jsx(cu,{placement:"left",title:e.jsx(eu,{level:3,children:"添加用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(k,{theme:"solid",size:"large",onClick:F,children:"提交"}),e.jsx(k,{theme:"solid",size:"large",type:"tertiary",onClick:l,children:"取消"})]})}),closeIcon:null,onCancel:()=>l(),width:we()?"100%":600,children:e.jsxs(De,{spinning:i,children:[e.jsx(se,{style:{marginTop:20},label:"用户名",name:"username",addonBefore:"用户名",placeholder:"请输入用户名",onChange:g=>o("username",g),value:p,autoComplete:"off"}),e.jsx(se,{style:{marginTop:20},addonBefore:"显示名",label:"显示名称",name:"display_name",autoComplete:"off",placeholder:"请输入显示名称",onChange:g=>o("display_name",g),value:C}),e.jsx(se,{style:{marginTop:20},label:"密 码",name:"password",type:"password",addonBefore:"密码",placeholder:"请输入密码",onChange:g=>o("password",g),value:A,autoComplete:"off"})]})})})},$u=u=>{const n=u.editingUser.id,[c,s]=t.useState(!0),[i,r]=t.useState(!1),[p,C]=t.useState(""),[A,o]=t.useState({username:"",display_name:"",password:"",github_id:"",wechat_id:"",email:"",quota:0,group:"default"}),[F,l]=t.useState([]),{username:g,display_name:w,password:O,github_id:I,wechat_id:z,telegram_id:b,email:J,quota:S,group:U}=A,W=(M,H)=>{o(E=>({...E,[M]:H}))},q=async()=>{try{let M=await $.get("/api/group/");l(M.data.data.map(H=>({label:H,value:H})))}catch(M){f(M.message)}};Pe();const Z=()=>{u.handleClose()},ue=async()=>{s(!0);let M;n?M=await $.get(`/api/user/${n}`):M=await $.get("/api/user/self");const{success:H,message:E,data:a}=M.data;H?(a.password="",o(a)):f(E),s(!1)};t.useEffect(()=>{ue().then(),n&&q().then()},[u.editingUser.id]);const V=async()=>{s(!0);let M;if(n){let a={...A,id:parseInt(n)};typeof a.quota=="string"&&(a.quota=parseInt(a.quota)),M=await $.put("/api/user/",a)}else M=await $.put("/api/user/self",A);const{success:H,message:E}=M.data;H?(Y("用户信息更新成功！"),u.refresh(),u.handleClose()):f(E),s(!1)},T=()=>{let M=parseInt(S)+parseInt(p);o(H=>({...H,quota:M}))},x=()=>{C("0"),r(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(cu,{placement:"right",title:e.jsx(eu,{level:3,children:"编辑用户"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(k,{theme:"solid",size:"large",onClick:V,children:"提交"}),e.jsx(k,{theme:"solid",size:"large",type:"tertiary",onClick:Z,children:"取消"})]})}),closeIcon:null,onCancel:()=>Z(),width:we()?"100%":600,children:e.jsxs(De,{spinning:c,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"用户名"})}),e.jsx(se,{label:"用户名",name:"username",placeholder:"请输入新的用户名",onChange:M=>W("username",M),value:g,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"密码"})}),e.jsx(se,{label:"密码",name:"password",type:"password",placeholder:"请输入新的密码，最短 8 位",onChange:M=>W("password",M),value:O,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"显示名称"})}),e.jsx(se,{label:"显示名称",name:"display_name",placeholder:"请输入新的显示名称",onChange:M=>W("display_name",M),value:w,autoComplete:"new-password"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"分组"})}),e.jsx(Te,{placeholder:"请选择分组",name:"group",fluid:!0,search:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:M=>W("group",M),value:A.group,autoComplete:"new-password",optionList:F}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:`剩余额度${lu(S)}`})}),e.jsxs(de,{children:[e.jsx(se,{name:"quota",placeholder:"请输入新的剩余额度",onChange:M=>W("quota",M),value:S,type:"number",autoComplete:"new-password"}),e.jsx(k,{onClick:x,children:"添加额度"})]})]}),e.jsx(Eu,{style:{marginTop:20},children:"以下信息不可修改"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"已绑定的 GitHub 账户"})}),e.jsx(se,{name:"github_id",value:I,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"已绑定的微信账户"})}),e.jsx(se,{name:"wechat_id",value:z,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"已绑定的邮箱账户"})}),e.jsx(se,{name:"email",value:J,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"已绑定的Telegram账户"})}),e.jsx(se,{name:"telegram_id",value:b,autoComplete:"new-password",placeholder:"此项只读，需要用户通过个人设置页面的相关绑定按钮进行绑定，不可直接修改",readonly:!0})]})}),e.jsxs(fe,{centered:!0,visible:i,onOk:()=>{T(),r(!1)},onCancel:()=>r(!1),closable:null,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:`新额度${ge(S)} + ${ge(p)} = ${ge(S+parseInt(p))}`})}),e.jsx(se,{name:"addQuotaLocal",placeholder:"需要添加的额度（支持负数）",onChange:M=>{C(M)},value:p,type:"number",autoComplete:"new-password"})]})]})};function gn(u){switch(u){case 1:return e.jsx(_,{size:"large",children:"普通用户"});case 10:return e.jsx(_,{color:"yellow",size:"large",children:"管理员"});case 100:return e.jsx(_,{color:"orange",size:"large",children:"超级管理员"});default:return e.jsx(_,{color:"red",size:"large",children:"未知身份"})}}const xn=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"用户名",dataIndex:"username"},{title:"分组",dataIndex:"group",render:(h,D,y)=>e.jsx("div",{children:ot(h)})},{title:"统计信息",dataIndex:"info",render:(h,D,y)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx(Oe,{content:"剩余额度",children:e.jsx(_,{color:"white",size:"large",children:ge(D.quota)})}),e.jsx(Oe,{content:"已用额度",children:e.jsx(_,{color:"white",size:"large",children:ge(D.used_quota)})}),e.jsx(Oe,{content:"调用次数",children:e.jsx(_,{color:"white",size:"large",children:ju(D.request_count)})})]})})},{title:"邀请信息",dataIndex:"invite",render:(h,D,y)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx(Oe,{content:"邀请人数",children:e.jsx(_,{color:"white",size:"large",children:ju(D.aff_count)})}),e.jsx(Oe,{content:"邀请总收益",children:e.jsx(_,{color:"white",size:"large",children:ge(D.aff_history_quota)})}),e.jsx(Oe,{content:"邀请人ID",children:D.inviter_id===0?e.jsx(_,{color:"white",size:"large",children:"无"}):e.jsx(_,{color:"white",size:"large",children:D.inviter_id})})]})})},{title:"角色",dataIndex:"role",render:(h,D,y)=>e.jsx("div",{children:gn(h)})},{title:"状态",dataIndex:"status",render:(h,D,y)=>e.jsx("div",{children:D.DeletedAt!==null?e.jsx(_,{color:"red",children:"已注销"}):x(h)})},{title:"",dataIndex:"operate",render:(h,D,y)=>e.jsxs("div",{children:[D.DeletedAt!==null?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:()=>{T(D.username,"promote",D)},children:e.jsx(k,{theme:"light",type:"warning",style:{marginRight:1},children:"提升"})}),e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:()=>{T(D.username,"demote",D)},children:e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},children:"降级"})}),D.status===1?e.jsx(k,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{T(D.username,"disable",D)},children:"禁用"}):e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{T(D.username,"enable",D)},disabled:D.status===3,children:"启用"}),e.jsx(k,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{q(D),U(!0)},children:"编辑"})]}),e.jsx(ve,{title:"确定是否要删除此用户？",content:"硬删除，此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{T(D.username,"delete",D).then(()=>{ue(D.id)})},children:e.jsx(k,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})})]})}],[n,c]=t.useState([]),[s,i]=t.useState(!0),[r,p]=t.useState(1),[C,A]=t.useState(""),[o,F]=t.useState(!1),[l,g]=t.useState(""),[w,O]=t.useState([]),[I,z]=t.useState(he),[b,J]=t.useState(!1),[S,U]=t.useState(!1),[W,q]=t.useState({id:void 0}),Z=h=>{h.length>=r*he?z(h.length+1):z(h.length)},ue=h=>{console.log(h);let D=[...n];if(h!=null){let y=D.findIndex(N=>N.id===h);y>-1&&(D.splice(y,1),c(D))}},V=async h=>{const D=await $.get(`/api/user/?p=${h}`),{success:y,message:N,data:X}=D.data;if(y)if(h===0)c(X),Z(X);else{let j=n;j.push(...X),c(j),Z(j)}else f(N);i(!1)};t.useEffect(()=>{V(0).then().catch(h=>{f(h)}),R().then()},[]);const T=async(h,D,y)=>{const N=await $.post("/api/user/manage",{username:h,action:D}),{success:X,message:j}=N.data;if(X){Y("操作成功完成！");let G=N.data.data,te=[...n];D==="delete"||(y.status=G.status,y.role=G.role),c(te)}else f(j)},x=h=>{switch(h){case 1:return e.jsx(_,{size:"large",children:"已激活"});case 2:return e.jsx(_,{size:"large",color:"red",children:"已封禁"});default:return e.jsx(_,{size:"large",color:"grey",children:"未知状态"})}},M=async(h,D)=>{if(h===""&&D===""){await V(0),p(1);return}F(!0);const y=await $.get(`/api/user/search?keyword=${h}&group=${D}`),{success:N,message:X,data:j}=y.data;N?(c(j),p(1)):f(X),F(!1)},H=async h=>{A(h.trim())},E=h=>{p(h),h===Math.ceil(n.length/he)+1&&V(h-1).then(D=>{})},a=n.slice((r-1)*he,r*he),d=()=>{J(!1)},m=()=>{U(!1),q({id:void 0})},B=async()=>{C===""?await V(r-1):await M()},R=async()=>{try{let h=await $.get("/api/group/");if(h===void 0)return;O(h.data.data.map(D=>({label:D,value:D})))}catch(h){f(h.message)}};return e.jsxs(e.Fragment,{children:[e.jsx(mn,{refresh:B,visible:b,handleClose:d}),e.jsx($u,{refresh:B,visible:S,handleClose:m,editingUser:W}),e.jsx(L,{onSubmit:()=>{M(C,l)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{children:[e.jsx(L.Input,{label:"搜索关键字",icon:"search",field:"keyword",iconPosition:"left",placeholder:"搜索用户的 ID，用户名，显示名称，以及邮箱地址 ...",value:C,loading:o,onChange:h=>H(h)}),e.jsx(L.Select,{field:"group",label:"分组",optionList:w,onChange:h=>{g(h),M(C,h)}}),e.jsx(k,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx(uu,{columns:u,dataSource:a,pagination:{currentPage:r,pageSize:he,total:I,pageSizeOpts:[10,20,50,100],onPageChange:E},loading:s}),e.jsx(k,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{J(!0)},children:"添加用户"})]})},En=()=>e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsx(re.Header,{children:e.jsx("h3",{children:"管理用户"})}),e.jsx(re.Content,{children:e.jsx(xn,{})})]})});function Ue({children:u}){return localStorage.getItem("user")?u:e.jsx(ft,{to:"/login",state:{from:an.location}})}const Cn=()=>{const[u,n]=t.useState({username:"",password:"",password2:"",email:"",verification_code:""}),{username:c,password:s,password2:i}=u,[r,p]=t.useState(!1),[C,A]=t.useState(!1),[o,F]=t.useState(""),[l,g]=t.useState(""),[w,O]=t.useState(!1),I=du();let z=new URLSearchParams(window.location.search).get("aff");z&&localStorage.setItem("aff",z),t.useEffect(()=>{let W=localStorage.getItem("status");W&&(W=JSON.parse(W),p(W.email_verification),W.turnstile_check&&(A(!0),F(W.turnstile_site_key)))});let b=Pe();function J(W){const{name:q,value:Z}=W.target;console.log(q,Z),n(ue=>({...ue,[q]:Z}))}async function S(W){if(s.length<8){Be("密码长度不得小于 8 位！");return}if(s!==i){Be("两次输入的密码不一致");return}if(c&&s){if(C&&l===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}O(!0),z||(z=localStorage.getItem("aff")),u.aff_code=z;const q=await $.post(`/api/user/register?turnstile=${l}`,u),{success:Z,message:ue}=q.data;Z?(b("/login"),Y("注册成功！")):f(ue),O(!1)}}const U=async()=>{if(u.email==="")return;if(C&&l===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}O(!0);const W=await $.get(`/api/verification?email=${u.email}&turnstile=${l}`),{success:q,message:Z}=W.data;q?Y("验证码发送成功，请检查你的邮箱！"):f(Z),O(!1)};return e.jsx(qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(qe.Column,{style:{maxWidth:450},children:[e.jsxs(ye,{as:"h2",color:"",textAlign:"center",children:[e.jsx(zu,{src:I})," 新用户注册"]}),e.jsx(K,{size:"large",children:e.jsxs(yu,{children:[e.jsx(K.Input,{fluid:!0,icon:"user",iconPosition:"left",placeholder:"输入用户名，最长 12 位",onChange:J,name:"username"}),e.jsx(K.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:J,name:"password",type:"password"}),e.jsx(K.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入密码，最短 8 位，最长 20 位",onChange:J,name:"password2",type:"password"}),r?e.jsxs(e.Fragment,{children:[e.jsx(K.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"输入邮箱地址",onChange:J,name:"email",type:"email",action:e.jsx(Ze,{onClick:U,disabled:w,children:"获取验证码"})}),e.jsx(K.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"输入验证码",onChange:J,name:"verification_code"})]}):e.jsx(e.Fragment,{}),C?e.jsx(au,{sitekey:o,onVerify:W=>{g(W)}}):e.jsx(e.Fragment,{}),e.jsx(Ze,{color:"green",fluid:!0,size:"large",onClick:S,loading:w,children:"注册"})]})}),e.jsxs(fu,{children:["已有账户？",e.jsx(iu,{to:"/login",className:"btn btn-link",children:"点击登录"})]})]})})},fn=(u,n)=>{switch(n.type){case"login":return{...u,user:n.payload};case"logout":return{...u,user:void 0};default:return u}},ct={user:void 0},Qe=ou.createContext({state:ct,dispatch:()=>null}),jn=({children:u})=>{const[n,c]=ou.useReducer(fn,ct);return e.jsx(Qe.Provider,{value:[n,c],children:u})};async function yn(){const u=await $.get("/api/oauth/state"),{success:n,message:c,data:s}=u.data;return n?s:(f(c),"")}async function dt(u){const n=await yn();n&&window.open(`https://github.com/login/oauth/authorize?client_id=${u}&state=${n}&scope=user:email`)}let Ge;async function Dn(){const u=await $.get("/api/models"),{success:n,data:c}=u.data;n&&(Ge=c,localStorage.setItem("channel_models",JSON.stringify(c)))}function vu(u){if(Ge!==void 0&&u in Ge)return Ge[u]?Ge[u]:[];let n=localStorage.getItem("channel_models");return n?(Ge=JSON.parse(n),u in Ge?Ge[u]:[]):[]}const Bn=()=>{function u(){return e.jsxs("svg",{t:"1709714447384",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5091",width:"16",height:"16",children:[e.jsx("path",{d:"M690.1 377.4c5.9 0 11.8 0.2 17.6 0.5-24.4-128.7-158.3-227.1-319.9-227.1C209 150.8 64 271.4 64 420.2c0 81.1 43.6 154.2 111.9 203.6 5.5 3.9 9.1 10.3 9.1 17.6 0 2.4-0.5 4.6-1.1 6.9-5.5 20.3-14.2 52.8-14.6 54.3-0.7 2.6-1.7 5.2-1.7 7.9 0 5.9 4.8 10.8 10.8 10.8 2.3 0 4.2-0.9 6.2-2l70.9-40.9c5.3-3.1 11-5 17.2-5 3.2 0 6.4 0.5 9.5 1.4 33.1 9.5 68.8 14.8 105.7 14.8 6 0 11.9-0.1 17.8-0.4-7.1-21-10.9-43.1-10.9-66 0-135.8 132.2-245.8 295.3-245.8z m-194.3-86.5c23.8 0 43.2 19.3 43.2 43.1s-19.3 43.1-43.2 43.1c-23.8 0-43.2-19.3-43.2-43.1s19.4-43.1 43.2-43.1z m-215.9 86.2c-23.8 0-43.2-19.3-43.2-43.1s19.3-43.1 43.2-43.1 43.2 19.3 43.2 43.1-19.4 43.1-43.2 43.1z","p-id":"5092"}),e.jsx("path",{d:"M866.7 792.7c56.9-41.2 93.2-102 93.2-169.7 0-124-120.8-224.5-269.9-224.5-149 0-269.9 100.5-269.9 224.5S540.9 847.5 690 847.5c30.8 0 60.6-4.4 88.1-12.3 2.6-0.8 5.2-1.2 7.9-1.2 5.2 0 9.9 1.6 14.3 4.1l59.1 34c1.7 1 3.3 1.7 5.2 1.7 2.4 0 4.7-0.9 6.4-2.6 1.7-1.7 2.6-4 2.6-6.4 0-2.2-0.9-4.4-1.4-6.6-0.3-1.2-7.6-28.3-12.2-45.3-0.5-1.9-0.9-3.8-0.9-5.7 0.1-5.9 3.1-11.2 7.6-14.5zM600.2 587.2c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c0 19.8-16.2 35.9-36 35.9z m179.9 0c-19.9 0-36-16.1-36-35.9 0-19.8 16.1-35.9 36-35.9s36 16.1 36 35.9c-0.1 19.8-16.2 35.9-36 35.9z","p-id":"5093"})]})}return e.jsx("div",{children:e.jsx(Zu,{svg:e.jsx(u,{})})})};function An(u){localStorage.setItem("status",JSON.stringify(u)),localStorage.setItem("system_name",u.system_name),localStorage.setItem("logo",u.logo),localStorage.setItem("footer_html",u.footer_html),localStorage.setItem("quota_per_unit",u.quota_per_unit),localStorage.setItem("display_in_currency",u.display_in_currency),localStorage.setItem("enable_drawing",u.enable_drawing),localStorage.setItem("enable_data_export",u.enable_data_export),localStorage.setItem("data_export_default_time",u.data_export_default_time),localStorage.setItem("default_collapse_sidebar",u.default_collapse_sidebar),localStorage.setItem("mj_notify_enabled",u.mj_notify_enabled),u.chat_link?localStorage.setItem("chat_link",u.chat_link):localStorage.removeItem("chat_link"),u.chat_link2?localStorage.setItem("chat_link2",u.chat_link2):localStorage.removeItem("chat_link2")}function bn(u){localStorage.setItem("user",JSON.stringify(u))}const Sn=()=>{const[u,n]=t.useState({username:"",password:"",wechat_verification_code:""}),[c,s]=Ru(),[i,r]=t.useState(!1),{username:p,password:C}=u,[A,o]=t.useContext(Qe),[F,l]=t.useState(!1),[g,w]=t.useState(""),[O,I]=t.useState("");let z=Pe();const[b,J]=t.useState({});du(),t.useEffect(()=>{c.get("expired")&&f("未登录或登录已过期，请重新登录！");let T=localStorage.getItem("status");T&&(T=JSON.parse(T),J(T),T.turnstile_check&&(l(!0),w(T.turnstile_site_key)))},[]);const[S,U]=t.useState(!1),W=()=>{U(!0)},q=async()=>{if(F&&O===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}const T=await $.get(`/api/oauth/wechat?code=${u.wechat_verification_code}`),{success:x,message:M,data:H}=T.data;x?(o({type:"login",payload:H}),localStorage.setItem("user",JSON.stringify(H)),z("/"),Y("登录成功！"),U(!1)):f(M)};function Z(T,x){n(M=>({...M,[T]:x}))}async function ue(T){if(F&&O===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}if(r(!0),p&&C){const x=await $.post(`/api/user/login?turnstile=${O}`,{username:p,password:C}),{success:M,message:H,data:E}=x.data;M?(o({type:"login",payload:E}),bn(E),Y("登录成功！"),p==="root"&&C==="123456"&&fe.error({title:"您正在使用默认密码！",content:"请立刻修改默认密码！",centered:!0}),z("/token")):f(H)}else f("请输入用户名和密码！")}const V=async T=>{const x=["id","first_name","last_name","username","photo_url","auth_date","hash","lang"],M={};x.forEach(m=>{T[m]&&(M[m]=T[m])});const H=await $.get("/api/oauth/telegram/login",{params:M}),{success:E,message:a,data:d}=H.data;E?(o({type:"login",payload:d}),localStorage.setItem("user",JSON.stringify(d)),Y("登录成功！"),z("/")):f(a)};return e.jsx("div",{children:e.jsxs(re,{children:[e.jsx(re.Header,{}),e.jsx(re.Content,{children:e.jsx("div",{style:{justifyContent:"center",display:"flex",marginTop:120},children:e.jsxs("div",{style:{width:500},children:[e.jsxs(be,{children:[e.jsx(eu,{heading:2,style:{textAlign:"center"},children:"用户登录"}),e.jsxs(L,{children:[e.jsx(L.Input,{field:"username",label:"用户名",placeholder:"用户名",name:"username",onChange:T=>Z("username",T)}),e.jsx(L.Input,{field:"password",label:"密码",placeholder:"密码",name:"password",type:"password",onChange:T=>Z("password",T)}),e.jsx(k,{theme:"solid",style:{width:"100%"},type:"primary",size:"large",htmlType:"submit",onClick:ue,children:"登录"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:20},children:[e.jsxs(Cu,{children:["没有账号请先 ",e.jsx(iu,{to:"/register",children:"注册账号"})]}),e.jsxs(Cu,{children:["忘记密码 ",e.jsx(iu,{to:"/reset",children:"点击重置"})]})]}),b.github_oauth||b.wechat_login||b.telegram_oauth?e.jsxs(e.Fragment,{children:[e.jsx(Eu,{margin:"12px",align:"center",children:"第三方登录"}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:[b.github_oauth?e.jsx(k,{type:"primary",icon:e.jsx(St,{}),onClick:()=>dt(b.github_client_id)}):e.jsx(e.Fragment,{}),b.wechat_login?e.jsx(k,{type:"primary",style:{color:"rgba(var(--semi-green-5), 1)"},icon:e.jsx(Zu,{svg:e.jsx(Bn,{})}),onClick:W}):e.jsx(e.Fragment,{})]}),b.telegram_oauth?e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:5},children:e.jsx(st,{dataOnauth:V,botName:b.telegram_bot_name})})}):e.jsx(e.Fragment,{})]}):e.jsx(e.Fragment,{}),e.jsxs(fe,{title:"微信扫码登录",visible:S,maskClosable:!0,onOk:q,onCancel:()=>U(!1),okText:"登录",size:"small",centered:!0,children:[e.jsx("div",{style:{display:"flex",alignItem:"center",flexDirection:"column"},children:e.jsx("img",{src:b.wechat_qrcode})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(L,{size:"large",children:e.jsx(L.Input,{field:"wechat_verification_code",placeholder:"验证码",label:"验证码",value:u.wechat_verification_code,onChange:T=>Z("wechat_verification_code",T)})})]})]}),F?e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:20},children:e.jsx(au,{sitekey:g,onVerify:T=>{I(T)}})}):e.jsx(e.Fragment,{})]})})})]})})},wn=()=>e.jsx(e.Fragment,{children:e.jsxs(fu,{negative:!0,children:[e.jsx(fu.Header,{children:"页面不存在"}),e.jsx("p",{children:"请检查你的浏览器地址是否正确"})]})}),ht=t.createContext(null),Ft=()=>t.useContext(ht),pt=t.createContext(null),vn=()=>t.useContext(pt),kn=({children:u})=>{const[n,c]=t.useState(()=>{try{return localStorage.getItem("theme-mode")||null}catch{return null}}),s=t.useCallback(i=>{c(i?"dark":"light");const r=document.body;i?(r.setAttribute("theme-mode","dark"),localStorage.setItem("theme-mode","dark")):(r.removeAttribute("theme-mode"),localStorage.setItem("theme-mode","light"))},[]);return e.jsx(pt.Provider,{value:s,children:e.jsx(ht.Provider,{value:n,children:u})})},_n=()=>{let[u,n]=t.useState({PasswordLoginEnabled:"",PasswordRegisterEnabled:"",EmailVerificationEnabled:"",GitHubOAuthEnabled:"",GitHubClientId:"",GitHubClientSecret:"",Notice:"",SMTPServer:"",SMTPPort:"",SMTPAccount:"",SMTPFrom:"",SMTPToken:"",ServerAddress:"",EpayId:"",EpayKey:"",Price:7.3,MinTopUp:1,TopupGroupRatio:"",PayAddress:"",CustomCallbackAddress:"",Footer:"",WeChatAuthEnabled:"",WeChatServerAddress:"",WeChatServerToken:"",WeChatAccountQRCodeImageURL:"",TurnstileCheckEnabled:"",TurnstileSiteKey:"",TurnstileSecretKey:"",RegisterEnabled:"",EmailDomainRestrictionEnabled:"",EmailAliasRestrictionEnabled:"",SMTPSSLEnabled:"",EmailDomainWhitelist:[],TelegramOAuthEnabled:"",TelegramBotToken:"",TelegramBotName:""});const[c,s]=t.useState({});let[i,r]=t.useState(!1);const[p,C]=t.useState([]),[A,o]=t.useState(""),[F,l]=t.useState(!1),w=Ft()==="dark",O=async()=>{const T=await $.get("/api/option/"),{success:x,message:M,data:H}=T.data;if(x){let E={};H.forEach(a=>{a.key==="TopupGroupRatio"&&(a.value=JSON.stringify(JSON.parse(a.value),null,2)),E[a.key]=a.value}),n({...E,EmailDomainWhitelist:E.EmailDomainWhitelist.split(",")}),s(E),C(E.EmailDomainWhitelist.split(",").map(a=>({key:a,text:a,value:a})))}else f(M)};t.useEffect(()=>{O().then()},[]),t.useEffect(()=>{},[u.EmailDomainWhitelist]);const I=async(T,x)=>{switch(r(!0),T){case"PasswordLoginEnabled":case"PasswordRegisterEnabled":case"EmailVerificationEnabled":case"GitHubOAuthEnabled":case"WeChatAuthEnabled":case"TelegramOAuthEnabled":case"TurnstileCheckEnabled":case"EmailDomainRestrictionEnabled":case"EmailAliasRestrictionEnabled":case"SMTPSSLEnabled":case"RegisterEnabled":x=u[T]==="true"?"false":"true";break}const M=await $.put("/api/option/",{key:T,value:x}),{success:H,message:E}=M.data;H?(T==="EmailDomainWhitelist"&&(x=x.split(",")),T==="Price"&&(x=parseFloat(x)),n(a=>({...a,[T]:x}))):f(E),r(!1)},z=async(T,{name:x,value:M})=>{if(x==="PasswordLoginEnabled"&&u[x]==="true"){l(!0);return}x==="Notice"||x.startsWith("SMTP")&&x!=="SMTPSSLEnabled"||x==="ServerAddress"||x==="EpayId"||x==="EpayKey"||x==="Price"||x==="PayAddress"||x==="GitHubClientId"||x==="GitHubClientSecret"||x==="WeChatServerAddress"||x==="WeChatServerToken"||x==="WeChatAccountQRCodeImageURL"||x==="TurnstileSiteKey"||x==="TurnstileSecretKey"||x==="EmailDomainWhitelist"||x==="TopupGroupRatio"||x==="TelegramBotToken"||x==="TelegramBotName"?n(H=>({...H,[x]:M})):await I(x,M)},b=async()=>{let T=wu(u.ServerAddress);await I("ServerAddress",T)},J=async()=>{if(u.ServerAddress===""){f("请先填写服务器地址");return}if(c.TopupGroupRatio!==u.TopupGroupRatio){if(!su(u.TopupGroupRatio)){f("充值分组倍率不是合法的 JSON 字符串");return}await I("TopupGroupRatio",u.TopupGroupRatio)}let T=wu(u.PayAddress);await I("PayAddress",T),u.EpayId!==""&&await I("EpayId",u.EpayId),u.EpayKey!==void 0&&u.EpayKey!==""&&await I("EpayKey",u.EpayKey),await I("Price",""+u.Price)},S=async()=>{c.SMTPServer!==u.SMTPServer&&await I("SMTPServer",u.SMTPServer),c.SMTPAccount!==u.SMTPAccount&&await I("SMTPAccount",u.SMTPAccount),c.SMTPFrom!==u.SMTPFrom&&await I("SMTPFrom",u.SMTPFrom),c.SMTPPort!==u.SMTPPort&&u.SMTPPort!==""&&await I("SMTPPort",u.SMTPPort),c.SMTPToken!==u.SMTPToken&&u.SMTPToken!==""&&await I("SMTPToken",u.SMTPToken)},U=async()=>{c.EmailDomainWhitelist!==u.EmailDomainWhitelist.join(",")&&u.SMTPToken!==""&&await I("EmailDomainWhitelist",u.EmailDomainWhitelist.join(","))},W=async()=>{c.WeChatServerAddress!==u.WeChatServerAddress&&await I("WeChatServerAddress",wu(u.WeChatServerAddress)),c.WeChatAccountQRCodeImageURL!==u.WeChatAccountQRCodeImageURL&&await I("WeChatAccountQRCodeImageURL",u.WeChatAccountQRCodeImageURL),c.WeChatServerToken!==u.WeChatServerToken&&u.WeChatServerToken!==""&&await I("WeChatServerToken",u.WeChatServerToken)},q=async()=>{c.GitHubClientId!==u.GitHubClientId&&await I("GitHubClientId",u.GitHubClientId),c.GitHubClientSecret!==u.GitHubClientSecret&&u.GitHubClientSecret!==""&&await I("GitHubClientSecret",u.GitHubClientSecret)},Z=async()=>{await I("TelegramBotToken",u.TelegramBotToken),await I("TelegramBotName",u.TelegramBotName)},ue=async()=>{c.TurnstileSiteKey!==u.TurnstileSiteKey&&await I("TurnstileSiteKey",u.TurnstileSiteKey),c.TurnstileSecretKey!==u.TurnstileSecretKey&&u.TurnstileSecretKey!==""&&await I("TurnstileSecretKey",u.TurnstileSecretKey)},V=()=>{const T=u.EmailDomainWhitelist;A!==""&&!T.includes(A)&&(o(""),n({...u,EmailDomainWhitelist:[...T,A]}),C([...p,{key:A,text:A,value:A}]))};return e.jsx(qe,{columns:1,children:e.jsx(qe.Column,{children:e.jsxs(K,{loading:i,inverted:w,children:[e.jsx(ye,{as:"h3",inverted:w,children:"通用设置"}),e.jsx(K.Group,{widths:"equal",children:e.jsx(K.Input,{label:"服务器地址",placeholder:"例如：https://yourdomain.com",value:u.ServerAddress,name:"ServerAddress",onChange:z})}),e.jsx(K.Button,{onClick:b,children:"更新服务器地址"}),e.jsx(Se,{}),e.jsx(ye,{as:"h3",inverted:w,children:"支付设置（当前仅支持易支付接口，默认使用上方服务器地址作为回调地址！）"}),e.jsxs(K.Group,{widths:"equal",children:[e.jsx(K.Input,{label:"支付地址，不填写则不启用在线支付",placeholder:"例如：https://yourdomain.com",value:u.PayAddress,name:"PayAddress",onChange:z}),e.jsx(K.Input,{label:"易支付商户ID",placeholder:"例如：0001",value:u.EpayId,name:"EpayId",onChange:z}),e.jsx(K.Input,{label:"易支付商户密钥",placeholder:"敏感信息不会发送到前端显示",value:u.EpayKey,name:"EpayKey",onChange:z})]}),e.jsxs(K.Group,{widths:"equal",children:[e.jsx(K.Input,{label:"回调地址，不填写则使用上方服务器地址作为回调地址",placeholder:"例如：https://yourdomain.com",value:u.CustomCallbackAddress,name:"CustomCallbackAddress",onChange:z}),e.jsx(K.Input,{label:"充值价格（x元/美金）",placeholder:"例如：7，就是7元/美金",value:u.Price,name:"Price",min:0,onChange:z}),e.jsx(K.Input,{label:"最低充值美元数量（以美金为单位，如果使用额度请自行换算！）",placeholder:"例如：2，就是最低充值2$",value:u.MinTopUp,name:"MinTopUp",min:1,onChange:z})]}),e.jsx(K.Group,{widths:"equal",children:e.jsx(K.TextArea,{label:"充值分组倍率",name:"TopupGroupRatio",onChange:z,style:{minHeight:250,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password",value:u.TopupGroupRatio,placeholder:"为一个 JSON 文本，键为组名称，值为倍率"})}),e.jsx(K.Button,{onClick:J,children:"更新支付设置"}),e.jsx(Se,{}),e.jsx(ye,{as:"h3",inverted:w,children:"配置登录注册"}),e.jsxs(K.Group,{inline:!0,children:[e.jsx(K.Checkbox,{checked:u.PasswordLoginEnabled==="true",label:"允许通过密码进行登录",name:"PasswordLoginEnabled",onChange:z}),F&&e.jsxs(mu,{open:F,onClose:()=>l(!1),size:"tiny",style:{maxWidth:"450px"},children:[e.jsx(mu.Header,{children:"警告"}),e.jsx(mu.Content,{children:e.jsx("p",{children:"取消密码登录将导致所有未绑定其他登录方式的用户（包括管理员）无法通过密码登录，确认取消？"})}),e.jsxs(mu.Actions,{children:[e.jsx(Ze,{onClick:()=>l(!1),children:"取消"}),e.jsx(Ze,{color:"yellow",onClick:async()=>{l(!1),await I("PasswordLoginEnabled","false")},children:"确定"})]})]}),e.jsx(K.Checkbox,{checked:u.PasswordRegisterEnabled==="true",label:"允许通过密码进行注册",name:"PasswordRegisterEnabled",onChange:z}),e.jsx(K.Checkbox,{checked:u.EmailVerificationEnabled==="true",label:"通过密码注册时需要进行邮箱验证",name:"EmailVerificationEnabled",onChange:z}),e.jsx(K.Checkbox,{checked:u.GitHubOAuthEnabled==="true",label:"允许通过 GitHub 账户登录 & 注册",name:"GitHubOAuthEnabled",onChange:z}),e.jsx(K.Checkbox,{checked:u.WeChatAuthEnabled==="true",label:"允许通过微信登录 & 注册",name:"WeChatAuthEnabled",onChange:z}),e.jsx(K.Checkbox,{checked:u.TelegramOAuthEnabled==="true",label:"允许通过 Telegram 进行登录",name:"TelegramOAuthEnabled",onChange:z})]}),e.jsxs(K.Group,{inline:!0,children:[e.jsx(K.Checkbox,{checked:u.RegisterEnabled==="true",label:"允许新用户注册（此项为否时，新用户将无法以任何方式进行注册）",name:"RegisterEnabled",onChange:z}),e.jsx(K.Checkbox,{checked:u.TurnstileCheckEnabled==="true",label:"启用 Turnstile 用户校验",name:"TurnstileCheckEnabled",onChange:z})]}),e.jsx(Se,{}),e.jsxs(ye,{as:"h3",inverted:w,children:["配置邮箱域名白名单",e.jsx(ye.Subheader,{children:"用以防止恶意用户利用临时邮箱批量注册"})]}),e.jsx(K.Group,{widths:3,children:e.jsx(K.Checkbox,{label:"启用邮箱域名白名单",name:"EmailDomainRestrictionEnabled",onChange:z,checked:u.EmailDomainRestrictionEnabled==="true"})}),e.jsx(K.Group,{widths:3,children:e.jsx(K.Checkbox,{label:"启用邮箱别名限制（例如：ab.cd@gmail.com）",name:"EmailAliasRestrictionEnabled",onChange:z,checked:u.EmailAliasRestrictionEnabled==="true"})}),e.jsxs(K.Group,{widths:2,children:[e.jsx(K.Dropdown,{label:"允许的邮箱域名",placeholder:"允许的邮箱域名",name:"EmailDomainWhitelist",required:!0,fluid:!0,multiple:!0,selection:!0,onChange:z,value:u.EmailDomainWhitelist,autoComplete:"new-password",options:p}),e.jsx(K.Input,{label:"添加新的允许的邮箱域名",action:e.jsx(Ze,{type:"button",onClick:()=>{V()},children:"填入"}),onKeyDown:T=>{T.key==="Enter"&&V()},autoComplete:"new-password",placeholder:"输入新的允许的邮箱域名",value:A,onChange:(T,{value:x})=>{o(x)}})]}),e.jsx(K.Button,{onClick:U,children:"保存邮箱域名白名单设置"}),e.jsx(Se,{}),e.jsxs(ye,{as:"h3",inverted:w,children:["配置 SMTP",e.jsx(ye.Subheader,{children:"用以支持系统的邮件发送"})]}),e.jsxs(K.Group,{widths:3,children:[e.jsx(K.Input,{label:"SMTP 服务器地址",name:"SMTPServer",onChange:z,autoComplete:"new-password",value:u.SMTPServer,placeholder:"例如：smtp.qq.com"}),e.jsx(K.Input,{label:"SMTP 端口",name:"SMTPPort",onChange:z,autoComplete:"new-password",value:u.SMTPPort,placeholder:"默认: 587"}),e.jsx(K.Input,{label:"SMTP 账户",name:"SMTPAccount",onChange:z,autoComplete:"new-password",value:u.SMTPAccount,placeholder:"通常是邮箱地址"})]}),e.jsxs(K.Group,{widths:3,children:[e.jsx(K.Input,{label:"SMTP 发送者邮箱",name:"SMTPFrom",onChange:z,autoComplete:"new-password",value:u.SMTPFrom,placeholder:"通常和邮箱地址保持一致"}),e.jsx(K.Input,{label:"SMTP 访问凭证",name:"SMTPToken",onChange:z,type:"password",autoComplete:"new-password",checked:u.RegisterEnabled==="true",placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(K.Group,{widths:3,children:e.jsx(K.Checkbox,{label:"启用SMTP SSL（465端口强制开启）",name:"SMTPSSLEnabled",onChange:z,checked:u.SMTPSSLEnabled==="true"})}),e.jsx(K.Button,{onClick:S,children:"保存 SMTP 设置"}),e.jsx(Se,{}),e.jsxs(ye,{as:"h3",inverted:w,children:["配置 GitHub OAuth App",e.jsxs(ye.Subheader,{children:["用以支持通过 GitHub 进行登录注册，",e.jsx("a",{href:"https://github.com/settings/developers",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 GitHub OAuth App"]})]}),e.jsxs(fu,{children:["Homepage URL 填 ",e.jsx("code",{children:u.ServerAddress}),"，Authorization callback URL 填"," ",e.jsx("code",{children:`${u.ServerAddress}/oauth/github`})]}),e.jsxs(K.Group,{widths:3,children:[e.jsx(K.Input,{label:"GitHub Client ID",name:"GitHubClientId",onChange:z,autoComplete:"new-password",value:u.GitHubClientId,placeholder:"输入你注册的 GitHub OAuth APP 的 ID"}),e.jsx(K.Input,{label:"GitHub Client Secret",name:"GitHubClientSecret",onChange:z,type:"password",autoComplete:"new-password",value:u.GitHubClientSecret,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(K.Button,{onClick:q,children:"保存 GitHub OAuth 设置"}),e.jsx(Se,{}),e.jsxs(ye,{as:"h3",inverted:w,children:["配置 WeChat Server",e.jsxs(ye.Subheader,{children:["用以支持通过微信进行登录注册，",e.jsx("a",{href:"https://github.com/songquanpeng/wechat-server",target:"_blank",rel:"noreferrer",children:"点击此处"}),"了解 WeChat Server"]})]}),e.jsxs(K.Group,{widths:3,children:[e.jsx(K.Input,{label:"WeChat Server 服务器地址",name:"WeChatServerAddress",placeholder:"例如：https://yourdomain.com",onChange:z,autoComplete:"new-password",value:u.WeChatServerAddress}),e.jsx(K.Input,{label:"WeChat Server 访问凭证",name:"WeChatServerToken",type:"password",onChange:z,autoComplete:"new-password",value:u.WeChatServerToken,placeholder:"敏感信息不会发送到前端显示"}),e.jsx(K.Input,{label:"微信公众号二维码图片链接",name:"WeChatAccountQRCodeImageURL",onChange:z,autoComplete:"new-password",value:u.WeChatAccountQRCodeImageURL,placeholder:"输入一个图片链接"})]}),e.jsx(K.Button,{onClick:W,children:"保存 WeChat Server 设置"}),e.jsx(Se,{}),e.jsx(ye,{as:"h3",inverted:w,children:"配置 Telegram 登录"}),e.jsxs(K.Group,{inline:!0,children:[e.jsx(K.Input,{label:"Telegram Bot Token",name:"TelegramBotToken",onChange:z,value:u.TelegramBotToken,placeholder:"输入你的 Telegram Bot Token"}),e.jsx(K.Input,{label:"Telegram Bot 名称",name:"TelegramBotName",onChange:z,value:u.TelegramBotName,placeholder:"输入你的 Telegram Bot 名称"})]}),e.jsx(K.Button,{onClick:Z,children:"保存 Telegram 登录设置"}),e.jsx(Se,{}),e.jsxs(ye,{as:"h3",inverted:w,children:["配置 Turnstile",e.jsxs(ye.Subheader,{children:["用以支持用户校验，",e.jsx("a",{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noreferrer",children:"点击此处"}),"管理你的 Turnstile Sites，推荐选择 Invisible Widget Type"]})]}),e.jsxs(K.Group,{widths:3,children:[e.jsx(K.Input,{label:"Turnstile Site Key",name:"TurnstileSiteKey",onChange:z,autoComplete:"new-password",value:u.TurnstileSiteKey,placeholder:"输入你注册的 Turnstile Site Key"}),e.jsx(K.Input,{label:"Turnstile Secret Key",name:"TurnstileSecretKey",onChange:z,type:"password",autoComplete:"new-password",value:u.TurnstileSecretKey,placeholder:"敏感信息不会发送到前端显示"})]}),e.jsx(K.Button,{onClick:ue,children:"保存 Turnstile 设置"})]})})})},Tn=()=>{let[u,n]=t.useState({Notice:"",SystemName:"",Logo:"",Footer:"",About:"",HomePageContent:""}),[c,s]=t.useState(!1);t.useState(!1),t.useState({tag_name:"",content:""});const i=async(b,J)=>{s(!0);const S=await $.put("/api/option/",{key:b,value:J}),{success:U,message:W}=S.data;U?n(q=>({...q,[b]:J})):f(W),s(!1)},[r,p]=t.useState({Notice:!1,SystemName:!1,Logo:!1,HomePageContent:!1,About:!1,Footer:!1}),C=async(b,J)=>{const S=J.target.id;n(U=>({...U,[S]:b}))},A=t.useRef(),o=async()=>{try{p(b=>({...b,Notice:!0})),await i("Notice",u.Notice),Y("公告已更新")}catch(b){console.error("公告更新失败",b),f("公告更新失败")}finally{p(b=>({...b,Notice:!1}))}},F=t.useRef(),l=async()=>{try{p(b=>({...b,SystemName:!0})),await i("SystemName",u.SystemName),Y("系统名称已更新")}catch(b){console.error("系统名称更新失败",b),f("系统名称更新失败")}finally{p(b=>({...b,SystemName:!1}))}},g=async()=>{try{p(b=>({...b,Logo:!0})),await i("Logo",u.Logo),Y("Logo 已更新")}catch(b){console.error("Logo 更新失败",b),f("Logo 更新失败")}finally{p(b=>({...b,Logo:!1}))}},w=async b=>{try{p(J=>({...J,HomePageContent:!0})),await i(b,u[b]),Y("首页内容已更新")}catch(J){console.error("首页内容更新失败",J),f("首页内容更新失败")}finally{p(J=>({...J,HomePageContent:!1}))}},O=async()=>{try{p(b=>({...b,About:!0})),await i("About",u.About),Y("关于内容已更新")}catch(b){console.error("关于内容更新失败",b),f("关于内容更新失败")}finally{p(b=>({...b,About:!1}))}},I=async()=>{try{p(b=>({...b,Footer:!0})),await i("Footer",u.Footer),Y("页脚内容已更新")}catch(b){console.error("页脚内容更新失败",b),f("页脚内容更新失败")}finally{p(b=>({...b,Footer:!1}))}},z=async()=>{const b=await $.get("/api/option/"),{success:J,message:S,data:U}=b.data;if(J){let W={};U.forEach(q=>{q.key in u&&(W[q.key]=q.value)}),n(W),A.current.setValues(W),F.current.setValues(W)}else f(S)};return t.useEffect(()=>{z()},[]),e.jsx(pe,{children:e.jsxs(ie,{span:24,children:[e.jsx(L,{values:u,getFormApi:b=>A.current=b,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"通用设置",children:[e.jsx(L.TextArea,{label:"公告",placeholder:"在此输入新的公告内容，支持 Markdown & HTML 代码",field:"Notice",onChange:C,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(k,{onClick:o,loading:r.Notice,children:"设置公告"})]})}),e.jsx(L,{values:u,getFormApi:b=>F.current=b,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"个性化设置",children:[e.jsx(L.Input,{label:"系统名称",placeholder:"在此输入系统名称",field:"SystemName",onChange:C}),e.jsx(k,{onClick:l,loading:r.SystemName,children:"设置系统名称"}),e.jsx(L.Input,{label:"Logo 图片地址",placeholder:"在此输入 Logo 图片地址",field:"Logo",onChange:C}),e.jsx(k,{onClick:g,loading:r.Logo,children:"设置 Logo"}),e.jsx(L.TextArea,{label:"首页内容",placeholder:"在此输入首页内容，支持 Markdown & HTML 代码，设置后首页的状态信息将不再显示。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为首页。",field:"HomePageContent",onChange:C,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(k,{onClick:()=>w("HomePageContent"),loading:r.HomePageContent,children:"设置首页内容"}),e.jsx(L.TextArea,{label:"关于",placeholder:"在此输入新的关于内容，支持 Markdown & HTML 代码。如果输入的是一个链接，则会使用该链接作为 iframe 的 src 属性，这允许你设置任意网页作为关于页面。",field:"About",onChange:C,style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}}),e.jsx(k,{onClick:O,loading:r.About,children:"设置关于"}),e.jsx(Xe,{fullMode:!1,type:"info",description:"移除 One API 的版权标识必须首先获得授权，项目维护需要花费大量精力，如果本项目对你有意义，请主动支持本项目。",closeIcon:null,style:{marginTop:15}}),e.jsx(L.Input,{label:"页脚",placeholder:"在此输入新的页脚，留空则使用默认页脚，支持 HTML 代码",field:"Footer",onChange:C}),e.jsx(k,{onClick:I,loading:r.Footer,children:"设置页脚"})]})})]})})},In=()=>{var hu,Fu,v,P,ne,ae,Fe,Ce,Re,Je,pu;const[u,n]=t.useContext(Qe);let c=Pe();const[s,i]=t.useState({wechat_verification_code:"",email_verification_code:"",email:"",self_account_deletion_confirmation:"",set_new_password:"",set_new_password_confirmation:""}),[r,p]=t.useState({}),[C,A]=t.useState(!1),[o,F]=t.useState(!1),[l,g]=t.useState(!1),[w,O]=t.useState(!1),[I,z]=t.useState(!1),[b,J]=t.useState(""),[S,U]=t.useState(""),[W,q]=t.useState(!1),[Z,ue]=t.useState(!1),[V,T]=t.useState(30),[x,M]=t.useState(""),[H,E]=t.useState(""),[a,d]=t.useState([]),[m,B]=t.useState(!1),[R,h]=t.useState(0);t.useEffect(()=>{let Q=localStorage.getItem("status");Q&&(Q=JSON.parse(Q),p(Q),Q.turnstile_check&&(z(!0),J(Q.turnstile_site_key))),X().then(xe=>{console.log(u)}),j().then(),N().then(),h(gu())},[]),t.useEffect(()=>{let Q=null;return Z&&V>0?Q=setInterval(()=>{T(V-1)},1e3):V===0&&(ue(!1),T(30)),()=>clearInterval(Q)},[Z,V]);const D=(Q,xe)=>{i(Ee=>({...Ee,[Q]:xe}))},y=async()=>{const Q=await $.get("/api/user/token"),{success:xe,message:Ee,data:Ne}=Q.data;xe?(E(Ne),await ze(Ne),Y("令牌已重置并已复制到剪贴板")):f(Ee)},N=async()=>{const Q=await $.get("/api/user/aff"),{success:xe,message:Ee,data:Ne}=Q.data;if(xe){let Et=`${window.location.origin}/register?aff=${Ne}`;M(Et)}else f(Ee)},X=async()=>{let Q=await $.get("/api/user/self");const{success:xe,message:Ee,data:Ne}=Q.data;xe?n({type:"login",payload:Ne}):f(Ee)},j=async()=>{let Q=await $.get("/api/user/models");const{success:xe,message:Ee,data:Ne}=Q.data;xe?(d(Ne),console.log(Ne)):f(Ee)},G=async Q=>{Q.target.select(),await ze(Q.target.value),Y("邀请链接已复制到剪切板")},te=async Q=>{Q.target.select(),await ze(Q.target.value),Y("系统令牌已复制到剪切板")},oe=async()=>{if(s.self_account_deletion_confirmation!==u.user.username){f("请输入你的账户名以确认删除！");return}const Q=await $.delete("/api/user/self"),{success:xe,message:Ee}=Q.data;xe?(Y("账户已删除！"),await $.get("/api/user/logout"),n({type:"logout"}),localStorage.removeItem("user"),c("/login")):f(Ee)},ce=async()=>{if(s.wechat_verification_code==="")return;const Q=await $.get(`/api/oauth/wechat/bind?code=${s.wechat_verification_code}`),{success:xe,message:Ee}=Q.data;xe?(Y("微信账户绑定成功！"),F(!1)):f(Ee)},le=async()=>{if(s.set_new_password!==s.set_new_password_confirmation){f("两次输入的密码不一致！");return}const Q=await $.put("/api/user/self",{password:s.set_new_password}),{success:xe,message:Ee}=Q.data;xe?(Y("密码修改成功！"),F(!1)):f(Ee),A(!1)},Ae=async()=>{if(R<gu()){f("划转金额最低为"+ge(gu()));return}const Q=await $.post("/api/user/aff_transfer",{quota:R}),{success:xe,message:Ee}=Q.data;xe?(Y(Ee),B(!1),X().then()):f(Ee)},ke=async()=>{if(s.email===""){f("请输入邮箱！");return}if(ue(!0),I&&S===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}q(!0);const Q=await $.get(`/api/verification?email=${s.email}&turnstile=${S}`),{success:xe,message:Ee}=Q.data;xe?Y("验证码发送成功，请检查邮箱！"):f(Ee),q(!1)},$e=async()=>{if(s.email_verification_code===""){f("请输入邮箱验证码！");return}q(!0);const Q=await $.get(`/api/oauth/email/bind?email=${s.email}&code=${s.email_verification_code}`),{success:xe,message:Ee}=Q.data;xe?(Y("邮箱账户绑定成功！"),g(!1),u.user.email=s.email):f(Ee),q(!1)},Me=()=>u.user?u.user.username:"null",tu=()=>{B(!1)},Au=async Q=>{await ze(Q)?Y("已复制："+Q):fe.error({title:"无法复制到剪贴板，请手动复制",content:Q})};return e.jsx("div",{children:e.jsx(re,{children:e.jsxs(re.Content,{children:[e.jsxs(fe,{title:"请输入要划转的数量",visible:m,onOk:Ae,onCancel:tu,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("div",{style:{marginTop:20},children:[e.jsx(ee.Text,{children:`可用额度${lu((hu=u==null?void 0:u.user)==null?void 0:hu.aff_quota)}`}),e.jsx(se,{style:{marginTop:5},value:(Fu=u==null?void 0:u.user)==null?void 0:Fu.aff_quota,disabled:!0})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(ee.Text,{children:`划转额度${lu(R)} 最低`+ge(gu())}),e.jsx("div",{children:e.jsx(ku,{min:0,style:{marginTop:5},value:R,onChange:Q=>h(Q),disabled:!1})})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsxs(be,{title:e.jsx(be.Meta,{avatar:e.jsx(Ou,{size:"default",color:ru(Me()),style:{marginRight:4},children:typeof Me()=="string"&&Me().slice(0,1)}),title:e.jsx(ee.Text,{children:Me()}),description:it()?e.jsx(_,{color:"red",children:"管理员"}):e.jsx(_,{color:"blue",children:"普通用户"})}),headerExtraContent:e.jsx(e.Fragment,{children:e.jsxs(de,{vertical:!0,align:"start",children:[e.jsx(_,{color:"green",children:"ID: "+((v=u==null?void 0:u.user)==null?void 0:v.id)}),e.jsx(_,{color:"blue",children:(P=u==null?void 0:u.user)==null?void 0:P.group})]})}),footer:e.jsxs(We,{row:!0,children:[e.jsx(We.Item,{itemKey:"当前余额",children:ge((ne=u==null?void 0:u.user)==null?void 0:ne.quota)}),e.jsx(We.Item,{itemKey:"历史消耗",children:ge((ae=u==null?void 0:u.user)==null?void 0:ae.used_quota)}),e.jsx(We.Item,{itemKey:"请求次数",children:(Fe=u.user)==null?void 0:Fe.request_count})]}),children:[e.jsx(ee.Title,{heading:6,children:"可用模型"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(de,{wrap:!0,children:a.map(Q=>e.jsx(_,{color:"cyan",onClick:()=>{Au(Q)},children:Q},Q))})})]}),e.jsxs(be,{footer:e.jsxs("div",{children:[e.jsx(ee.Text,{children:"邀请链接"}),e.jsx(se,{style:{marginTop:10},value:x,onClick:G,readOnly:!0})]}),children:[e.jsx(ee.Title,{heading:6,children:"邀请信息"}),e.jsx("div",{style:{marginTop:10},children:e.jsxs(We,{row:!0,children:[e.jsxs(We.Item,{itemKey:"待使用收益",children:[e.jsx("span",{style:{color:"rgba(var(--semi-red-5), 1)"},children:ge((Ce=u==null?void 0:u.user)==null?void 0:Ce.aff_quota)}),e.jsx(k,{type:"secondary",onClick:()=>B(!0),size:"small",style:{marginLeft:10},children:"划转"})]}),e.jsx(We.Item,{itemKey:"总收益",children:ge((Re=u==null?void 0:u.user)==null?void 0:Re.aff_history_quota)}),e.jsx(We.Item,{itemKey:"邀请人数",children:(Je=u==null?void 0:u.user)==null?void 0:Je.aff_count})]})})]}),e.jsxs(be,{children:[e.jsx(ee.Title,{heading:6,children:"个人信息"}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(ee.Text,{strong:!0,children:"邮箱"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.email!==""?u.user.email:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(k,{onClick:()=>{g(!0)},children:u.user&&u.user.email!==""?"修改绑定":"绑定邮箱"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ee.Text,{strong:!0,children:"微信"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.wechat_id!==""?"已绑定":"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(k,{disabled:u.user&&u.user.wechat_id!==""||!r.wechat_login,children:r.wechat_login?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ee.Text,{strong:!0,children:"GitHub"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.github_id!==""?u.user.github_id:"未绑定",readonly:!0})}),e.jsx("div",{children:e.jsx(k,{onClick:()=>{dt(r.github_client_id)},disabled:u.user&&u.user.github_id!==""||!r.github_oauth,children:r.github_oauth?"绑定":"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(ee.Text,{strong:!0,children:"Telegram"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsx(se,{value:u.user&&u.user.telegram_id!==""?u.user.telegram_id:"未绑定",readonly:!0})}),e.jsx("div",{children:r.telegram_oauth?u.user.telegram_id!==""?e.jsx(k,{disabled:!0,children:"已绑定"}):e.jsx(st,{dataAuthUrl:"/api/oauth/telegram/bind",botName:r.telegram_bot_name}):e.jsx(k,{disabled:!0,children:"未启用"})})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsxs(de,{children:[e.jsx(k,{onClick:y,children:"生成系统访问令牌"}),e.jsx(k,{onClick:()=>{A(!0)},children:"修改密码"}),e.jsx(k,{type:"danger",onClick:()=>{O(!0)},children:"删除个人账户"})]}),H&&e.jsx(se,{readOnly:!0,value:H,onClick:te,style:{marginTop:"10px"}}),r.wechat_login&&e.jsx(k,{onClick:()=>{F(!0)},children:"绑定微信账号"}),e.jsxs(fe,{onCancel:()=>F(!1),visible:o,size:"small",children:[e.jsx(wt,{src:r.wechat_qrcode}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx("p",{children:"微信扫码关注公众号，输入「验证码」获取验证码（三分钟内有效）"})}),e.jsx(se,{placeholder:"验证码",name:"wechat_verification_code",value:s.wechat_verification_code,onChange:Q=>D("wechat_verification_code",Q)}),e.jsx(k,{color:"",fluid:!0,size:"large",onClick:ce,children:"绑定"})]})]})]}),e.jsxs(fe,{onCancel:()=>g(!1),onOk:$e,visible:l,size:"small",centered:!0,maskClosable:!1,children:[e.jsx(ee.Title,{heading:6,children:"绑定邮箱地址"}),e.jsxs("div",{style:{marginTop:20,display:"flex",justifyContent:"space-between"},children:[e.jsx(se,{fluid:!0,placeholder:"输入邮箱地址",onChange:Q=>D("email",Q),name:"email",type:"email"}),e.jsx(k,{onClick:ke,disabled:Z||W,children:Z?`重新发送 (${V})`:"获取验证码"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(se,{fluid:!0,placeholder:"验证码",name:"email_verification_code",value:s.email_verification_code,onChange:Q=>D("email_verification_code",Q)})}),I?e.jsx(au,{sitekey:b,onVerify:Q=>{U(Q)}}):e.jsx(e.Fragment,{})]}),e.jsxs(fe,{onCancel:()=>O(!1),visible:w,size:"small",centered:!0,onOk:oe,children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(Xe,{type:"danger",description:"您正在删除自己的帐户，将清空所有数据且不可恢复",closeIcon:null})}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(se,{placeholder:`输入你的账户名 ${(pu=u==null?void 0:u.user)==null?void 0:pu.username} 以确认删除`,name:"self_account_deletion_confirmation",value:s.self_account_deletion_confirmation,onChange:Q=>D("self_account_deletion_confirmation",Q)}),I?e.jsx(au,{sitekey:b,onVerify:Q=>{U(Q)}}):e.jsx(e.Fragment,{})]})]}),e.jsx(fe,{onCancel:()=>A(!1),visible:C,size:"small",centered:!0,onOk:le,children:e.jsxs("div",{style:{marginTop:20},children:[e.jsx(se,{name:"set_new_password",placeholder:"新密码",value:s.set_new_password,onChange:Q=>D("set_new_password",Q)}),e.jsx(se,{style:{marginTop:20},name:"set_new_password_confirmation",placeholder:"确认新密码",value:s.set_new_password_confirmation,onChange:Q=>D("set_new_password_confirmation",Q)}),I?e.jsx(au,{sitekey:b,onVerify:Q=>{U(Q)}}):e.jsx(e.Fragment,{})]})})]})]})})})};function Pn(u){const[n,c]=t.useState(!1),[s,i]=t.useState({TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:"",RetryTimes:"",DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,DefaultCollapseSidebar:!1}),r=t.useRef(),[p,C]=t.useState(s);function A(F,l){const g=l.target.id;i(w=>({...w,[g]:F}))}function o(){const F=Ve(s,p);if(!F.length)return Ke("你似乎并没有修改什么");const l=F.map(g=>{let w="";return typeof s[g.key]=="boolean"?w=String(s[g.key]):w=s[g.key],$.put("/api/option/",{key:g.key,value:w})});c(!0),Promise.all(l).then(g=>{if(l.length===1){if(g.includes(void 0))return}else if(l.length>1&&g.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const F={};for(let l in u.options)Object.keys(s).includes(l)&&(F[l]=u.options[l]);i(F),C(structuredClone(F)),r.current.setValues(F)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:s,getFormApi:F=>r.current=F,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"通用设置",children:[e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.Input,{field:"TopUpLink",label:"充值链接",initValue:"",placeholder:"例如发卡网站的购买链接",onChange:A,showClear:!0})}),e.jsx(ie,{span:8,children:e.jsx(L.Input,{field:"ChatLink",label:"默认聊天页面链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:A,showClear:!0})}),e.jsx(ie,{span:8,children:e.jsx(L.Input,{field:"ChatLink2",label:"聊天页面 2 链接",initValue:"",placeholder:"例如 ChatGPT Next Web 的部署地址",onChange:A,showClear:!0})}),e.jsx(ie,{span:8,children:e.jsx(L.Input,{field:"QuotaPerUnit",label:"单位美元额度",initValue:"",placeholder:"一单位货币能兑换的额度",onChange:A,showClear:!0})}),e.jsx(ie,{span:8,children:e.jsx(L.Input,{field:"RetryTimes",label:"失败重试次数",initValue:"",placeholder:"失败重试次数",onChange:A,showClear:!0})})]}),e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"DisplayInCurrencyEnabled",label:"以货币形式显示额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{i({...s,DisplayInCurrencyEnabled:F})}})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"DisplayTokenStatEnabled",label:"Billing 相关 API 显示令牌额度而非用户额度",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,DisplayTokenStatEnabled:F})})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"DefaultCollapseSidebar",label:"默认折叠侧边栏",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>i({...s,DefaultCollapseSidebar:F})})})]}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:o,children:"保存通用设置"})})]})})})})}function $n(u){const[n,c]=t.useState(!1),[s,i]=t.useState({DrawingEnabled:!1,MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjForwardUrlEnabled:!1,MjModeClearEnabled:!1}),r=t.useRef(),[p,C]=t.useState(s);function A(){const o=Ve(s,p);if(!o.length)return Ke("你似乎并没有修改什么");const F=o.map(l=>{let g="";return typeof s[l.key]=="boolean"?g=String(s[l.key]):g=s[l.key],$.put("/api/option/",{key:l.key,value:g})});c(!0),Promise.all(F).then(l=>{if(F.length===1){if(l.includes(void 0))return}else if(F.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const o={};for(let F in u.options)Object.keys(s).includes(F)&&(o[F]=u.options[F]);i(o),C(structuredClone(o)),r.current.setValues(o),localStorage.setItem("mj_notify_enabled",String(s.MjNotifyEnabled))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:s,getFormApi:o=>r.current=o,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"绘图设置",children:[e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"DrawingEnabled",label:"启用绘图功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>{i({...s,DrawingEnabled:o})}})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"MjNotifyEnabled",label:"允许回调（会泄露服务器 IP 地址）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>i({...s,MjNotifyEnabled:o})})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"MjAccountFilterEnabled",label:"允许 AccountFilter 参数",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>i({...s,MjAccountFilterEnabled:o})})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"MjForwardUrlEnabled",label:"开启之后将上游地址替换为服务器地址",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>i({...s,MjForwardUrlEnabled:o})})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"MjModeClearEnabled",label:e.jsxs(e.Fragment,{children:["开启之后会清除用户提示词中的 ",e.jsx(_,{children:"--fast"})," 、",e.jsx(_,{children:"--relax"})," 以及 ",e.jsx(_,{children:"--turbo"})," 参数"]}),size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>i({...s,MjModeClearEnabled:o})})})]}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:A,children:"保存绘图设置"})})]})})})})}function Mn(u){const[n,c]=t.useState(!1),[s,i]=t.useState({CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,SensitiveWords:""}),r=t.useRef(),[p,C]=t.useState(s);function A(){const o=Ve(s,p);if(!o.length)return Ke("你似乎并没有修改什么");const F=o.map(l=>{let g="";return typeof s[l.key]=="boolean"?g=String(s[l.key]):g=s[l.key],$.put("/api/option/",{key:l.key,value:g})});c(!0),Promise.all(F).then(l=>{if(F.length===1){if(l.includes(void 0))return}else if(F.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const o={};for(let F in u.options)Object.keys(s).includes(F)&&(o[F]=u.options[F]);i(o),C(structuredClone(o)),r.current.setValues(o)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:s,getFormApi:o=>r.current=o,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"屏蔽词过滤设置",children:[e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"CheckSensitiveEnabled",label:"启用屏蔽词过滤功能",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>{i({...s,CheckSensitiveEnabled:o})}})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"CheckSensitiveOnPromptEnabled",label:"启用 Prompt 检查",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>i({...s,CheckSensitiveOnPromptEnabled:o})})})]}),e.jsx(pe,{children:e.jsx(ie,{span:16,children:e.jsx(L.TextArea,{label:"屏蔽词列表",extraText:"一行一个屏蔽词，不需要符号分割",placeholder:"一行一个屏蔽词，不需要符号分割",field:"SensitiveWords",onChange:o=>i({...s,SensitiveWords:o}),style:{fontFamily:"JetBrains Mono, Consolas"},autosize:{minRows:6,maxRows:12}})})}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:A,children:"保存屏蔽词过滤设置"})})]})})})})}var mt={exports:{}};(function(u,n){(function(c,s){u.exports=s()})(jt,function(){var c=1e3,s=6e4,i=36e5,r="millisecond",p="second",C="minute",A="hour",o="day",F="week",l="month",g="quarter",w="year",O="date",I="Invalid Date",z=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,b=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,J={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(E){var a=["th","st","nd","rd"],d=E%100;return"["+E+(a[(d-20)%10]||a[d]||a[0])+"]"}},S=function(E,a,d){var m=String(E);return!m||m.length>=a?E:""+Array(a+1-m.length).join(d)+E},U={s:S,z:function(E){var a=-E.utcOffset(),d=Math.abs(a),m=Math.floor(d/60),B=d%60;return(a<=0?"+":"-")+S(m,2,"0")+":"+S(B,2,"0")},m:function E(a,d){if(a.date()<d.date())return-E(d,a);var m=12*(d.year()-a.year())+(d.month()-a.month()),B=a.clone().add(m,l),R=d-B<0,h=a.clone().add(m+(R?-1:1),l);return+(-(m+(d-B)/(R?B-h:h-B))||0)},a:function(E){return E<0?Math.ceil(E)||0:Math.floor(E)},p:function(E){return{M:l,y:w,w:F,d:o,D:O,h:A,m:C,s:p,ms:r,Q:g}[E]||String(E||"").toLowerCase().replace(/s$/,"")},u:function(E){return E===void 0}},W="en",q={};q[W]=J;var Z="$isDayjsObject",ue=function(E){return E instanceof M||!(!E||!E[Z])},V=function E(a,d,m){var B;if(!a)return W;if(typeof a=="string"){var R=a.toLowerCase();q[R]&&(B=R),d&&(q[R]=d,B=R);var h=a.split("-");if(!B&&h.length>1)return E(h[0])}else{var D=a.name;q[D]=a,B=D}return!m&&B&&(W=B),B||!m&&W},T=function(E,a){if(ue(E))return E.clone();var d=typeof a=="object"?a:{};return d.date=E,d.args=arguments,new M(d)},x=U;x.l=V,x.i=ue,x.w=function(E,a){return T(E,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var M=function(){function E(d){this.$L=V(d.locale,null,!0),this.parse(d),this.$x=this.$x||d.x||{},this[Z]=!0}var a=E.prototype;return a.parse=function(d){this.$d=function(m){var B=m.date,R=m.utc;if(B===null)return new Date(NaN);if(x.u(B))return new Date;if(B instanceof Date)return new Date(B);if(typeof B=="string"&&!/Z$/i.test(B)){var h=B.match(z);if(h){var D=h[2]-1||0,y=(h[7]||"0").substring(0,3);return R?new Date(Date.UTC(h[1],D,h[3]||1,h[4]||0,h[5]||0,h[6]||0,y)):new Date(h[1],D,h[3]||1,h[4]||0,h[5]||0,h[6]||0,y)}}return new Date(B)}(d),this.init()},a.init=function(){var d=this.$d;this.$y=d.getFullYear(),this.$M=d.getMonth(),this.$D=d.getDate(),this.$W=d.getDay(),this.$H=d.getHours(),this.$m=d.getMinutes(),this.$s=d.getSeconds(),this.$ms=d.getMilliseconds()},a.$utils=function(){return x},a.isValid=function(){return this.$d.toString()!==I},a.isSame=function(d,m){var B=T(d);return this.startOf(m)<=B&&B<=this.endOf(m)},a.isAfter=function(d,m){return T(d)<this.startOf(m)},a.isBefore=function(d,m){return this.endOf(m)<T(d)},a.$g=function(d,m,B){return x.u(d)?this[m]:this.set(B,d)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(d,m){var B=this,R=!!x.u(m)||m,h=x.p(d),D=function(ce,le){var Ae=x.w(B.$u?Date.UTC(B.$y,le,ce):new Date(B.$y,le,ce),B);return R?Ae:Ae.endOf(o)},y=function(ce,le){return x.w(B.toDate()[ce].apply(B.toDate("s"),(R?[0,0,0,0]:[23,59,59,999]).slice(le)),B)},N=this.$W,X=this.$M,j=this.$D,G="set"+(this.$u?"UTC":"");switch(h){case w:return R?D(1,0):D(31,11);case l:return R?D(1,X):D(0,X+1);case F:var te=this.$locale().weekStart||0,oe=(N<te?N+7:N)-te;return D(R?j-oe:j+(6-oe),X);case o:case O:return y(G+"Hours",0);case A:return y(G+"Minutes",1);case C:return y(G+"Seconds",2);case p:return y(G+"Milliseconds",3);default:return this.clone()}},a.endOf=function(d){return this.startOf(d,!1)},a.$set=function(d,m){var B,R=x.p(d),h="set"+(this.$u?"UTC":""),D=(B={},B[o]=h+"Date",B[O]=h+"Date",B[l]=h+"Month",B[w]=h+"FullYear",B[A]=h+"Hours",B[C]=h+"Minutes",B[p]=h+"Seconds",B[r]=h+"Milliseconds",B)[R],y=R===o?this.$D+(m-this.$W):m;if(R===l||R===w){var N=this.clone().set(O,1);N.$d[D](y),N.init(),this.$d=N.set(O,Math.min(this.$D,N.daysInMonth())).$d}else D&&this.$d[D](y);return this.init(),this},a.set=function(d,m){return this.clone().$set(d,m)},a.get=function(d){return this[x.p(d)]()},a.add=function(d,m){var B,R=this;d=Number(d);var h=x.p(m),D=function(X){var j=T(R);return x.w(j.date(j.date()+Math.round(X*d)),R)};if(h===l)return this.set(l,this.$M+d);if(h===w)return this.set(w,this.$y+d);if(h===o)return D(1);if(h===F)return D(7);var y=(B={},B[C]=s,B[A]=i,B[p]=c,B)[h]||1,N=this.$d.getTime()+d*y;return x.w(N,this)},a.subtract=function(d,m){return this.add(-1*d,m)},a.format=function(d){var m=this,B=this.$locale();if(!this.isValid())return B.invalidDate||I;var R=d||"YYYY-MM-DDTHH:mm:ssZ",h=x.z(this),D=this.$H,y=this.$m,N=this.$M,X=B.weekdays,j=B.months,G=B.meridiem,te=function(le,Ae,ke,$e){return le&&(le[Ae]||le(m,R))||ke[Ae].slice(0,$e)},oe=function(le){return x.s(D%12||12,le,"0")},ce=G||function(le,Ae,ke){var $e=le<12?"AM":"PM";return ke?$e.toLowerCase():$e};return R.replace(b,function(le,Ae){return Ae||function(ke){switch(ke){case"YY":return String(m.$y).slice(-2);case"YYYY":return x.s(m.$y,4,"0");case"M":return N+1;case"MM":return x.s(N+1,2,"0");case"MMM":return te(B.monthsShort,N,j,3);case"MMMM":return te(j,N);case"D":return m.$D;case"DD":return x.s(m.$D,2,"0");case"d":return String(m.$W);case"dd":return te(B.weekdaysMin,m.$W,X,2);case"ddd":return te(B.weekdaysShort,m.$W,X,3);case"dddd":return X[m.$W];case"H":return String(D);case"HH":return x.s(D,2,"0");case"h":return oe(1);case"hh":return oe(2);case"a":return ce(D,y,!0);case"A":return ce(D,y,!1);case"m":return String(y);case"mm":return x.s(y,2,"0");case"s":return String(m.$s);case"ss":return x.s(m.$s,2,"0");case"SSS":return x.s(m.$ms,3,"0");case"Z":return h}return null}(le)||h.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(d,m,B){var R,h=this,D=x.p(m),y=T(d),N=(y.utcOffset()-this.utcOffset())*s,X=this-y,j=function(){return x.m(h,y)};switch(D){case w:R=j()/12;break;case l:R=j();break;case g:R=j()/3;break;case F:R=(X-N)/6048e5;break;case o:R=(X-N)/864e5;break;case A:R=X/i;break;case C:R=X/s;break;case p:R=X/c;break;default:R=X}return B?R:x.a(R)},a.daysInMonth=function(){return this.endOf(l).$D},a.$locale=function(){return q[this.$L]},a.locale=function(d,m){if(!d)return this.$L;var B=this.clone(),R=V(d,m,!0);return R&&(B.$L=R),B},a.clone=function(){return x.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},E}(),H=M.prototype;return T.prototype=H,[["$ms",r],["$s",p],["$m",C],["$H",A],["$W",o],["$M",l],["$y",w],["$D",O]].forEach(function(E){H[E[1]]=function(a){return this.$g(a,E[0],E[1])}}),T.extend=function(E,a){return E.$i||(E(a,M,T),E.$i=!0),T},T.locale=V,T.isDayjs=ue,T.unix=function(E){return T(1e3*E)},T.en=q[W],T.Ls=q,T.p={},T})})(mt);var Rn=mt.exports;const On=yt(Rn);function zn(u){const[n,c]=t.useState(!1),[s,i]=t.useState(!1),[r,p]=t.useState({LogConsumeEnabled:!1,historyTimestamp:On().subtract(1,"month").toDate()}),C=t.useRef(),[A,o]=t.useState(r);function F(){const g=Ve(r,A).filter(O=>O.key!=="historyTimestamp");if(!g.length)return Ke("你似乎并没有修改什么");const w=g.map(O=>{let I="";return typeof r[O.key]=="boolean"?I=String(r[O.key]):I=r[O.key],$.put("/api/option/",{key:O.key,value:I})});c(!0),Promise.all(w).then(O=>{if(w.length===1){if(O.includes(void 0))return}else if(w.length>1&&O.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}async function l(){try{if(i(!0),!r.historyTimestamp)throw new Error("请选择日志记录时间");const g=await $.delete(`/api/log/?target_timestamp=${Date.parse(r.historyTimestamp)/1e3}`),{success:w,message:O,data:I}=g.data;if(w){Y(`${I} 条日志已清理！`);return}else throw new Error("日志清理失败："+O)}catch(g){f(g.message)}finally{i(!1)}}return t.useEffect(()=>{const g={};for(let w in u.options)Object.keys(r).includes(w)&&(g[w]=u.options[w]);g.historyTimestamp=r.historyTimestamp,p(Object.assign(r,g)),o(structuredClone(g)),C.current.setValues(g)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:r,getFormApi:g=>C.current=g,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"日志设置",children:[e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"LogConsumeEnabled",label:"启用额度消费日志记录",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:g=>{p({...r,LogConsumeEnabled:g})}})}),e.jsx(ie,{span:8,children:e.jsxs(De,{spinning:s,children:[e.jsx(L.DatePicker,{label:"日志记录时间",field:"historyTimestamp",type:"dateTime",inputReadOnly:!0,onChange:g=>{p({...r,historyTimestamp:g})}}),e.jsx(k,{size:"default",onClick:l,children:"清除历史日志"})]})})]}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:F,children:"保存日志设置"})})]})})})})}function Ln(u){const n=[{key:"hour",label:"小时",value:"hour"},{key:"day",label:"天",value:"day"},{key:"week",label:"周",value:"week"}],[c,s]=t.useState(!1),[i,r]=t.useState({DataExportEnabled:!1,DataExportInterval:"",DataExportDefaultTime:""}),p=t.useRef(),[C,A]=t.useState(i);function o(){const F=Ve(i,C);if(!F.length)return Ke("你似乎并没有修改什么");const l=F.map(g=>{let w="";return typeof i[g.key]=="boolean"?w=String(i[g.key]):w=i[g.key],$.put("/api/option/",{key:g.key,value:w})});s(!0),Promise.all(l).then(g=>{if(l.length===1){if(g.includes(void 0))return}else if(l.length>1&&g.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{s(!1)})}return t.useEffect(()=>{const F={};for(let l in u.options)Object.keys(i).includes(l)&&(F[l]=u.options[l]);r(F),A(structuredClone(F)),p.current.setValues(F),localStorage.setItem("data_export_default_time",String(i.DataExportDefaultTime))},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:c,children:e.jsx(L,{values:i,getFormApi:F=>p.current=F,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"数据看板设置",children:[e.jsx(pe,{gutter:16,children:e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"DataExportEnabled",label:"启用数据看板（实验性）",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:F=>{r({...i,DataExportEnabled:F})}})})}),e.jsxs(pe,{children:[e.jsx(ie,{span:8,children:e.jsx(L.InputNumber,{label:"数据看板更新间隔 ",step:1,min:1,suffix:"分钟",extraText:"设置过短会影响数据库性能",placeholder:"数据看板更新间隔",field:"DataExportInterval",onChange:F=>r({...i,DataExportInterval:String(F)})})}),e.jsx(ie,{span:8,children:e.jsx(L.Select,{label:"数据看板默认时间粒度",optionList:n,field:"DataExportDefaultTime",extraText:"仅修改展示粒度，统计精确到小时",placeholder:"数据看板默认时间粒度",style:{width:180},onChange:F=>r({...i,DataExportDefaultTime:String(F)})})})]}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:o,children:"保存数据看板设置"})})]})})})})}function Nn(u){const[n,c]=t.useState(!1),[s,i]=t.useState({ChannelDisableThreshold:"",QuotaRemindThreshold:"",AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1}),r=t.useRef(),[p,C]=t.useState(s);function A(){const o=Ve(s,p);if(!o.length)return Ke("你似乎并没有修改什么");const F=o.map(l=>{let g="";return typeof s[l.key]=="boolean"?g=String(s[l.key]):g=s[l.key],$.put("/api/option/",{key:l.key,value:g})});c(!0),Promise.all(F).then(l=>{if(F.length===1){if(l.includes(void 0))return}else if(F.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const o={};for(let F in u.options)Object.keys(s).includes(F)&&(o[F]=u.options[F]);i(o),C(structuredClone(o)),r.current.setValues(o)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:s,getFormApi:o=>r.current=o,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"监控设置",children:[e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.InputNumber,{label:"最长响应时间",step:1,min:0,suffix:"秒",extraText:"当运行通道全部测试时，超过此时间将自动禁用通道",placeholder:"",field:"ChannelDisableThreshold",onChange:o=>i({...s,ChannelDisableThreshold:String(o)})})}),e.jsx(ie,{span:8,children:e.jsx(L.InputNumber,{label:"额度提醒阈值",step:1,min:0,suffix:"Token",extraText:"低于此额度时将发送邮件提醒用户",placeholder:"",field:"QuotaRemindThreshold",onChange:o=>i({...s,QuotaRemindThreshold:String(o)})})})]}),e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"AutomaticDisableChannelEnabled",label:"失败时自动禁用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>{i({...s,AutomaticDisableChannelEnabled:o})}})}),e.jsx(ie,{span:8,children:e.jsx(L.Switch,{field:"AutomaticEnableChannelEnabled",label:"成功时自动启用通道",size:"large",checkedText:"｜",uncheckedText:"〇",onChange:o=>i({...s,AutomaticEnableChannelEnabled:o})})})]}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:A,children:"保存监控设置"})})]})})})})}function Un(u){const[n,c]=t.useState(!1),[s,i]=t.useState({QuotaForNewUser:"",PreConsumedQuota:"",QuotaForInviter:"",QuotaForInvitee:""}),r=t.useRef(),[p,C]=t.useState(s);function A(){const o=Ve(s,p);if(!o.length)return Ke("你似乎并没有修改什么");const F=o.map(l=>{let g="";return typeof s[l.key]=="boolean"?g=String(s[l.key]):g=s[l.key],$.put("/api/option/",{key:l.key,value:g})});c(!0),Promise.all(F).then(l=>{if(F.length===1){if(l.includes(void 0))return}else if(F.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}return t.useEffect(()=>{const o={};for(let F in u.options)Object.keys(s).includes(F)&&(o[F]=u.options[F]);i(o),C(structuredClone(o)),r.current.setValues(o)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:s,getFormApi:o=>r.current=o,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"额度设置",children:[e.jsxs(pe,{gutter:16,children:[e.jsx(ie,{span:6,children:e.jsx(L.InputNumber,{label:"新用户初始额度",field:"QuotaForNewUser",step:1,min:0,suffix:"Token",placeholder:"",onChange:o=>i({...s,QuotaForNewUser:String(o)})})}),e.jsx(ie,{span:6,children:e.jsx(L.InputNumber,{label:"请求预扣费额度",field:"PreConsumedQuota",step:1,min:0,suffix:"Token",extraText:"请求结束后多退少补",placeholder:"",onChange:o=>i({...s,PreConsumedQuota:String(o)})})}),e.jsx(ie,{span:6,children:e.jsx(L.InputNumber,{label:"邀请新用户奖励额度",field:"QuotaForInviter",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：2000",onChange:o=>i({...s,QuotaForInviter:String(o)})})}),e.jsx(ie,{span:6,children:e.jsx(L.InputNumber,{label:"新用户使用邀请码奖励额度",field:"QuotaForInvitee",step:1,min:0,suffix:"Token",extraText:"",placeholder:"例如：1000",onChange:o=>i({...s,QuotaForInvitee:String(o)})})})]}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:A,children:"保存额度设置"})})]})})})})}function Wn(u){const[n,c]=t.useState(!1),[s,i]=t.useState({ModelPrice:"",ModelRatio:"",CompletionRatio:"",GroupRatio:""}),r=t.useRef(),[p,C]=t.useState(s);async function A(){try{await r.current.validate();const o=Ve(s,p);if(!o.length)return Ke("你似乎并没有修改什么");const F=o.map(l=>{let g="";return typeof s[l.key]=="boolean"?g=String(s[l.key]):g=s[l.key],$.put("/api/option/",{key:l.key,value:g})});c(!0),Promise.all(F).then(l=>{if(F.length===1){if(l.includes(void 0))return}else if(F.length>1&&l.includes(void 0))return f("部分保存失败，请重试");Y("保存成功"),u.refresh()}).catch(()=>{f("保存失败，请重试")}).finally(()=>{c(!1)})}catch(o){f("请检查输入"),console.error(o)}finally{}}return t.useEffect(()=>{const o={};for(let F in u.options)Object.keys(s).includes(F)&&(o[F]=u.options[F]);i(o),C(structuredClone(o)),r.current.setValues(o)},[u.options]),e.jsx(e.Fragment,{children:e.jsx(De,{spinning:n,children:e.jsx(L,{values:s,getFormApi:o=>r.current=o,style:{marginBottom:15},children:e.jsxs(L.Section,{text:"倍率设置",children:[e.jsx(pe,{gutter:16,children:e.jsx(ie,{span:16,children:e.jsx(L.TextArea,{label:"模型固定价格",extraText:"一次调用消耗多少刀，优先级大于模型倍率",placeholder:'为一个 JSON 文本，键为模型名称，值为一次调用消耗多少刀，比如 "gpt-4-gizmo-*": 0.1，一次消耗0.1刀',field:"ModelPrice",autosize:{minRows:6,maxRows:12},trigger:"blur",rules:[{validator:(o,F)=>su(F),message:"不是合法的 JSON 字符串"}],onChange:o=>i({...s,ModelPrice:o})})})}),e.jsx(pe,{gutter:16,children:e.jsx(ie,{span:16,children:e.jsx(L.TextArea,{label:"模型倍率",extraText:"",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"ModelRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",rules:[{validator:(o,F)=>su(F),message:"不是合法的 JSON 字符串"}],onChange:o=>i({...s,ModelRatio:o})})})}),e.jsx(pe,{gutter:16,children:e.jsx(ie,{span:16,children:e.jsx(L.TextArea,{label:"模型补全倍率",extraText:"仅对自定义模型有效",placeholder:"为一个 JSON 文本，键为模型名称，值为倍率",field:"CompletionRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",rules:[{validator:(o,F)=>su(F),message:"不是合法的 JSON 字符串"}],onChange:o=>i({...s,CompletionRatio:o})})})}),e.jsx(pe,{gutter:16,children:e.jsx(ie,{span:16,children:e.jsx(L.TextArea,{label:"分组倍率",extraText:"",placeholder:"为一个 JSON 文本，键为分组名称，值为倍率",field:"GroupRatio",autosize:{minRows:6,maxRows:12},trigger:"blur",rules:[{validator:(o,F)=>su(F),message:"不是合法的 JSON 字符串"}],onChange:o=>i({...s,GroupRatio:o})})})}),e.jsx(pe,{children:e.jsx(k,{size:"large",onClick:A,children:"保存倍率设置"})})]})})})})}const Gn=()=>{let[u,n]=t.useState({QuotaForNewUser:0,QuotaForInviter:0,QuotaForInvitee:0,QuotaRemindThreshold:0,PreConsumedQuota:0,StreamCacheQueueLength:0,ModelRatio:"",CompletionRatio:"",ModelPrice:"",GroupRatio:"",TopUpLink:"",ChatLink:"",ChatLink2:"",QuotaPerUnit:0,AutomaticDisableChannelEnabled:!1,AutomaticEnableChannelEnabled:!1,ChannelDisableThreshold:0,LogConsumeEnabled:!1,DisplayInCurrencyEnabled:!1,DisplayTokenStatEnabled:!1,CheckSensitiveEnabled:!1,CheckSensitiveOnPromptEnabled:!1,CheckSensitiveOnCompletionEnabled:"",StopOnSensitiveEnabled:"",SensitiveWords:"",MjNotifyEnabled:!1,MjAccountFilterEnabled:!1,MjModeClearEnabled:!1,MjForwardUrlEnabled:!1,DrawingEnabled:!1,DataExportEnabled:!1,DataExportDefaultTime:"hour",DataExportInterval:5,DefaultCollapseSidebar:!1,RetryTimes:0}),[c,s]=t.useState(!1);const i=async()=>{const p=await $.get("/api/option/"),{success:C,message:A,data:o}=p.data;if(C){let F={};o.forEach(l=>{(l.key==="ModelRatio"||l.key==="GroupRatio"||l.key==="CompletionRatio"||l.key==="ModelPrice")&&(l.value=JSON.stringify(JSON.parse(l.value),null,2)),l.key.endsWith("Enabled")||["DefaultCollapseSidebar"].includes(l.key)?F[l.key]=l.value==="true":F[l.key]=l.value}),n(F)}else f(A)};async function r(){try{s(!0),await i(),Y("刷新成功")}catch{f("刷新失败")}finally{s(!1)}}return t.useEffect(()=>{r()},[]),e.jsx(e.Fragment,{children:e.jsxs(De,{spinning:c,size:"large",children:[e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Pn,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx($n,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Mn,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(zn,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Ln,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Nn,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Un,{options:u,refresh:r})}),e.jsx(be,{style:{marginTop:"10px"},children:e.jsx(Wn,{options:u,refresh:r})})]})})},Hn=()=>{const u=Pe(),n=Dt(),[c,s]=t.useState("1");let i=[{tab:"个人设置",content:e.jsx(In,{}),itemKey:"personal"}];it()&&(i.push({tab:"运营设置",content:e.jsx(Gn,{}),itemKey:"operation"}),i.push({tab:"系统设置",content:e.jsx(_n,{}),itemKey:"system"}),i.push({tab:"其他设置",content:e.jsx(Tn,{}),itemKey:"other"}));const r=p=>{s(p),u(`?tab=${p}`)};return t.useEffect(()=>{const C=new URLSearchParams(window.location.search).get("tab");C?s(C):r("personal")},[n.search]),e.jsx("div",{children:e.jsx(re,{children:e.jsx(re.Content,{children:e.jsx(vt,{type:"line",activeKey:c,onChange:p=>r(p),children:i.map(p=>e.jsx(kt,{itemKey:p.itemKey,tab:p.tab,children:c===p.itemKey&&p.content},p.itemKey))})})})})},qn=()=>{const[u,n]=t.useState({email:""}),{email:c}=u,[s,i]=t.useState(!1),[r,p]=t.useState(!1),[C,A]=t.useState(""),[o,F]=t.useState(""),[l,g]=t.useState(!1),[w,O]=t.useState(30);t.useEffect(()=>{let b=null;return l&&w>0?b=setInterval(()=>{O(w-1)},1e3):w===0&&(g(!1),O(30)),()=>clearInterval(b)},[l,w]);function I(b){const{name:J,value:S}=b.target;n(U=>({...U,[J]:S}))}async function z(b){if(g(!0),!c)return;if(r&&o===""){Be("请稍后几秒重试，Turnstile 正在检查用户环境！");return}i(!0);const J=await $.get(`/api/reset_password?email=${c}&turnstile=${o}`),{success:S,message:U}=J.data;S?(Y("重置邮件发送成功，请检查邮箱！"),n({...u,email:""})):f(U),i(!1)}return e.jsx(qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(qe.Column,{style:{maxWidth:450},children:[e.jsxs(ye,{as:"h2",color:"",textAlign:"center",children:[e.jsx(zu,{src:"/logo.png"})," 密码重置"]}),e.jsx(K,{size:"large",children:e.jsxs(yu,{children:[e.jsx(K.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:c,onChange:I}),r?e.jsx(au,{sitekey:C,onVerify:b=>{F(b)}}):e.jsx(e.Fragment,{}),e.jsx(Ze,{color:"green",fluid:!0,size:"large",onClick:z,loading:s,disabled:l,children:l?`重试 (${w})`:"提交"})]})})]})})},Kn=()=>{const[u,n]=Ru(),[c,s]=t.useContext(Qe),[i,r]=t.useState("处理中...");t.useState(!0);let p=Pe();const C=async(A,o,F)=>{const l=await $.get(`/api/oauth/github?code=${A}&state=${o}`),{success:g,message:w,data:O}=l.data;if(g)w==="bind"?(Y("绑定成功！"),p("/setting")):(s({type:"login",payload:O}),localStorage.setItem("user",JSON.stringify(O)),Y("登录成功！"),p("/"));else{f(w);{r("操作失败，重定向至登录界面中..."),p("/setting");return}}};return t.useEffect(()=>{let A=u.get("code"),o=u.get("state");C(A,o).then()},[]),e.jsx(yu,{style:{minHeight:"300px"},children:e.jsx(Qt,{active:!0,inverted:!0,children:e.jsx(Jt,{size:"large",children:i})})})},Vn=()=>{const[u,n]=t.useState({email:"",token:""}),{email:c,token:s}=u,[i,r]=t.useState(!1),[p,C]=t.useState(!1),[A,o]=t.useState(30),[F,l]=t.useState(""),[g,w]=Ru();t.useEffect(()=>{let I=g.get("token"),z=g.get("email");n({token:I,email:z})},[]),t.useEffect(()=>{let I=null;return p&&A>0?I=setInterval(()=>{o(A-1)},1e3):A===0&&(C(!1),o(30)),()=>clearInterval(I)},[p,A]);async function O(I){if(C(!0),!c)return;r(!0);const z=await $.post("/api/user/reset",{email:c,token:s}),{success:b,message:J}=z.data;if(b){let S=z.data.data;l(S),await ze(S),Gu(`新密码已复制到剪贴板：${S}`)}else f(J);r(!1)}return e.jsx(qe,{textAlign:"center",style:{marginTop:"48px"},children:e.jsxs(qe.Column,{style:{maxWidth:450},children:[e.jsxs(ye,{as:"h2",color:"",textAlign:"center",children:[e.jsx(zu,{src:"/logo.png"})," 密码重置确认"]}),e.jsx(K,{size:"large",children:e.jsxs(yu,{children:[e.jsx(K.Input,{fluid:!0,icon:"mail",iconPosition:"left",placeholder:"邮箱地址",name:"email",value:c,readOnly:!0}),F&&e.jsx(K.Input,{fluid:!0,icon:"lock",iconPosition:"left",placeholder:"新密码",name:"newPassword",value:F,readOnly:!0,onClick:I=>{I.target.select(),navigator.clipboard.writeText(F),Gu(`密码已复制到剪贴板：${F}`)}}),e.jsx(Ze,{color:"green",fluid:!0,size:"large",onClick:O,loading:i,disabled:p,children:p?"密码重置完成":"提交"})]})})]})})},Ku={"gpt-3.5-turbo-0301":"gpt-3.5-turbo","gpt-4-0314":"gpt-4","gpt-4-32k-0314":"gpt-4-32k"},Vu={400:"500"};function Qn(u){switch(u){case 15:return"按照如下格式输入：APIKey|SecretKey";case 18:return"按照如下格式输入：APPID|APISecret|APIKey";case 22:return"按照如下格式输入：APIKey-AppId，例如：fastgpt-0sp2gtvfdgyi4k30jwlgwf1i-64f335d84283f05518e9e041";case 23:return"按照如下格式输入：AppId|SecretId|SecretKey";case 33:return"按照如下格式输入：Ak|Sk|Region";default:return"请输入渠道对应的鉴权密钥"}}const Mu=u=>{Pe();const n=u.editingChannel.id,c=n!==void 0,[s,i]=t.useState(c),r=()=>{u.handleClose()},p={name:"",type:1,key:"",openai_organization:"",max_input_tokens:0,base_url:"",other:"",model_mapping:"",status_code_mapping:"",models:[],auto_ban:1,test_model:"",groups:["default"],ratio:1},[C,A]=t.useState(!1),[o,F]=t.useState(!0),[l,g]=t.useState(p),[w,O]=t.useState([]),[I,z]=t.useState([]),[b,J]=t.useState([]),[S,U]=t.useState([]),[W,q]=t.useState([]),[Z,ue]=t.useState(""),V=(a,d)=>{if(g(m=>({...m,[a]:d})),a==="type"){let m=[];switch(d){case 2:m=["mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_uploads"];break;case 5:m=["swap_face","mj_imagine","mj_variation","mj_reroll","mj_blend","mj_upscale","mj_describe","mj_zoom","mj_shorten","mj_modal","mj_inpaint","mj_custom_zoom","mj_high_variation","mj_low_variation","mj_pan","mj_uploads"];break;default:m=vu(d);break}l.models.length===0&&g(B=>({...B,models:m})),U(m)}},T=async()=>{i(!0);let a=await $.get(`/api/channel/${n}`);if(a===void 0)return;const{success:d,message:m,data:B}=a.data;d?(B.models===""?B.models=[]:B.models=B.models.split(","),B.group===""?B.groups=[]:B.groups=B.group.split(","),B.model_mapping!==""&&(B.model_mapping=JSON.stringify(JSON.parse(B.model_mapping),null,2)),g(B),B.auto_ban===0?F(!1):F(!0),U(vu(B.type))):f(m),i(!1)},x=async()=>{try{let a=await $.get("/api/channel/models");if(a===void 0)return;let d=a.data.data.map(m=>({label:m.id,value:m.id}));O(d),q(a.data.data.map(m=>m.id)),U(a.data.data.filter(m=>m.id.startsWith("gpt-3")||m.id.startsWith("text-")).map(m=>m.id))}catch(a){f(a.message)}},M=async()=>{try{let a=await $.get("/api/group/");if(a===void 0)return;J(a.data.data.map(d=>({label:d,value:d})))}catch(a){f(a.message)}};t.useEffect(()=>{let a=[...w];l.models.forEach(d=>{a.find(m=>m.key===d)||a.push({label:d,value:d})}),z(a)},[w,l.models]),t.useEffect(()=>{if(x().then(),M().then(),c)T().then(()=>{});else{g(p);let a=vu(l.type);U(a),g(d=>({...d,models:a}))}},[u.editingChannel.id]);const H=async()=>{if(!c&&(l.name===""||l.key==="")){Be("请填写渠道名称和渠道密钥！");return}if(l.models.length===0){Be("请至少选择一个模型！");return}if(l.model_mapping!==""&&!su(l.model_mapping)){Be("模型映射必须是合法的 JSON 格式！");return}let a={...l};a.base_url&&a.base_url.endsWith("/")&&(a.base_url=a.base_url.slice(0,a.base_url.length-1)),a.type===3&&a.other===""&&(a.other="2023-06-01-preview"),a.type===18&&a.other===""&&(a.other="v2.1");let d;if(!Array.isArray(a.models)){f("提交失败，请勿重复提交！"),r();return}a.auto_ban=o?1:0,a.ratio=parseFloat(a.ratio),a.models=a.models.join(","),a.group=a.groups.join(","),c?d=await $.put("/api/channel/",{...a,id:parseInt(n)}):d=await $.post("/api/channel/",a);const{success:m,message:B}=d.data;m?(c?Y("渠道更新成功！"):(Y("渠道创建成功！"),g(p)),u.refresh(),u.handleClose()):f(B)},E=()=>{if(Z.trim()==="")return;const a=Z.split(",").map(R=>R.trim());let d=[...l.models],m=[...I],B=!1;a.forEach(R=>{R&&!d.includes(R)?(d.push(R),m.push({key:R,text:R,value:R})):R&&(f("某些模型已存在！"),B=!0)}),!B&&(z(m),ue(""),V("models",d))};return e.jsx(e.Fragment,{children:e.jsx(cu,{maskClosable:!1,placement:c?"right":"left",title:e.jsx(eu,{level:3,children:c?"更新渠道信息":"创建新的渠道"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visible,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(k,{theme:"solid",size:"large",onClick:H,children:"提交"}),e.jsx(k,{theme:"solid",size:"large",type:"tertiary",onClick:r,children:"取消"})]})}),closeIcon:null,onCancel:()=>r(),width:we()?"100%":600,children:e.jsxs(De,{spinning:s,children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"类型："})}),e.jsx(Te,{name:"type",required:!0,optionList:xu,value:l.type,onChange:a=>V("type",a),style:{width:"50%"}}),l.type===3&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(Xe,{type:"warning",description:e.jsxs(e.Fragment,{children:["注意，",e.jsx("strong",{children:"模型部署名称必须和模型名称保持一致"}),"，因为 One API 会把请求体中的 model 参数替换为你的部署名称（模型名称中的点会被剔除），",e.jsx("a",{target:"_blank",href:"https://github.com/songquanpeng/one-api/issues/133?notification_referrer_id=NT_kwDOAmJSYrM2NjIwMzI3NDgyOjM5OTk4MDUw#issuecomment-1571602271",children:"图片演示"}),"。"]})})}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"AZURE_OPENAI_ENDPOINT："})}),e.jsx(se,{label:"AZURE_OPENAI_ENDPOINT",name:"azure_base_url",placeholder:"请输入 AZURE_OPENAI_ENDPOINT，例如：https://docs-test-001.openai.azure.com",onChange:a=>{V("base_url",a)},value:l.base_url,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"默认 API 版本："})}),e.jsx(se,{label:"默认 API 版本",name:"azure_other",placeholder:"请输入默认 API 版本，例如：2023-06-01-preview，该配置可以被实际的请求查询参数所覆盖",onChange:a=>{V("other",a)},value:l.other,autoComplete:"new-password"})]}),l.type===8&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"Base URL："})}),e.jsx(se,{name:"base_url",placeholder:"请输入自定义渠道的 Base URL",onChange:a=>{V("base_url",a)},value:l.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"名称："})}),e.jsx(se,{required:!0,name:"name",placeholder:"请为渠道命名",onChange:a=>{V("name",a)},value:l.name,autoComplete:"new-password"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"分组："})}),e.jsx(Te,{placeholder:"请选择可以使用该渠道的分组",name:"groups",required:!0,multiple:!0,selection:!0,allowAdditions:!0,additionLabel:"请在系统设置页面编辑分组倍率以添加新的分组：",onChange:a=>{V("groups",a)},value:l.groups,autoComplete:"new-password",optionList:b}),l.type===18&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"模型版本："})}),e.jsx(se,{name:"other",placeholder:"请输入星火大模型版本，注意是接口地址中的版本号，例如：v2.1",onChange:a=>{V("other",a)},value:l.other,autoComplete:"new-password"})]}),l.type===21&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"知识库 ID："})}),e.jsx(se,{label:"知识库 ID",name:"other",placeholder:"请输入知识库 ID，例如：123456",onChange:a=>{V("other",a)},value:l.other,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"模型："})}),e.jsx(Te,{placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:a=>{V("models",a)},value:l.models,autoComplete:"new-password",optionList:I}),e.jsxs("div",{style:{lineHeight:"40px",marginBottom:"12px"},children:[e.jsxs(de,{children:[e.jsx(k,{type:"primary",onClick:()=>{V("models",S)},children:"填入相关模型"}),e.jsx(k,{type:"secondary",onClick:()=>{V("models",W)},children:"填入所有模型"}),e.jsx(k,{type:"warning",onClick:()=>{V("models",[])},children:"清除所有模型"})]}),e.jsx(se,{addonAfter:e.jsx(k,{type:"primary",onClick:E,children:"填入"}),placeholder:"输入自定义模型名称",value:Z,onChange:a=>{ue(a.trim())}})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"模型重定向："})}),e.jsx(bu,{placeholder:`此项可选，用于修改请求体中的模型名称，为一个 JSON 字符串，键为请求中模型名称，值为要替换的模型名称，例如：
${JSON.stringify(Ku,null,2)}`,name:"model_mapping",onChange:a=>{V("model_mapping",a)},autosize:!0,value:l.model_mapping,autoComplete:"new-password"}),e.jsx(ee.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{V("model_mapping",JSON.stringify(Ku,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"密钥："})}),C?e.jsx(bu,{label:"密钥",name:"key",required:!0,placeholder:"请输入密钥，一行一个",onChange:a=>{V("key",a)},value:l.key,style:{minHeight:150,fontFamily:"JetBrains Mono, Consolas"},autoComplete:"new-password"}):e.jsx(se,{label:"密钥",name:"key",required:!0,placeholder:Qn(l.type),onChange:a=>{V("key",a)},value:l.key,autoComplete:"new-password"}),l.type===1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"组织："})}),e.jsx(se,{label:"组织，可选，不填则为默认组织",name:"openai_organization",placeholder:"请输入组织org-xxx",onChange:a=>{V("openai_organization",a)},value:l.openai_organization})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"默认测试模型："})}),e.jsx(se,{name:"test_model",placeholder:"不填则为模型列表第一个",onChange:a=>{V("test_model",a)},value:l.test_model}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(_u,{name:"auto_ban",checked:o,onChange:()=>{F(!o)}}),e.jsx(ee.Text,{strong:!0,children:"是否自动禁用（仅当自动禁用开启时有效），关闭后不会自动禁用该渠道："})]})}),!c&&e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(_u,{checked:C,label:"批量创建",name:"batch",onChange:()=>A(!C)}),e.jsx(ee.Text,{strong:!0,children:"批量创建"})]})}),l.type!==3&&l.type!==8&&l.type!==22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"代理："})}),e.jsx(se,{label:"代理",name:"base_url",placeholder:"此项可选，用于通过代理站来进行 API 调用",onChange:a=>{V("base_url",a)},value:l.base_url,autoComplete:"new-password"})]}),l.type===22&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"私有部署地址："})}),e.jsx(se,{name:"base_url",placeholder:"请输入私有部署地址，格式为：https://fastgpt.run/api/openapi",onChange:a=>{V("base_url",a)},value:l.base_url,autoComplete:"new-password"})]}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"状态码复写（仅影响本地判断，不修改返回到上游的状态码）："})}),e.jsx(bu,{placeholder:`此项可选，用于复写返回的状态码，比如将claude渠道的400错误复写为500（用于重试），请勿滥用该功能，例如：
${JSON.stringify(Vu,null,2)}`,name:"status_code_mapping",onChange:a=>{V("status_code_mapping",a)},autosize:!0,value:l.status_code_mapping,autoComplete:"new-password"}),e.jsx(ee.Text,{style:{color:"rgba(var(--semi-blue-5), 1)",userSelect:"none",cursor:"pointer"},onClick:()=>{V("status_code_mapping",JSON.stringify(Vu,null,2))},children:"填入模板"}),e.jsx("div",{style:{marginTop:10},children:e.jsx(ee.Text,{strong:!0,children:"费率（默认为1）："})}),e.jsx(se,{label:"费率",name:"ratio",placeholder:"默认为1",onChange:a=>{V("ratio",a)},value:l.ratio})]})})})};let nu;function Jn(u){var n,c;if(!nu){nu=new Map;for(let s=0;s<xu.length;s++)nu[xu[s].value]=xu[s];nu[0]={value:0,text:"未知类型",color:"grey"}}return e.jsx(_,{size:"large",color:(n=nu[u])==null?void 0:n.color,children:(c=nu[u])==null?void 0:c.text})}const Yn=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"分组",dataIndex:"group",render:(v,P,ne)=>e.jsx("div",{children:e.jsx(de,{spacing:2,children:v.split(",").map((ae,Fe)=>ot(ae))})})},{title:"类型",dataIndex:"type",render:(v,P,ne)=>e.jsx("div",{children:Jn(v)})},{title:"状态",dataIndex:"status",render:(v,P,ne)=>e.jsx("div",{children:N(v)})},{title:"响应时间",dataIndex:"response_time",render:(v,P,ne)=>e.jsx("div",{children:X(v)})},{title:"已用/剩余",dataIndex:"expired_time",render:(v,P,ne)=>e.jsx("div",{children:e.jsxs(de,{spacing:1,children:[e.jsx(Oe,{content:"已用额度",children:e.jsx(_,{color:"white",type:"ghost",size:"large",children:ge(P.used_quota)})}),e.jsx(Oe,{content:"剩余额度"+P.balance+"，点击更新",children:e.jsxs(_,{color:"white",type:"ghost",size:"large",onClick:()=>{ce(P)},children:["$",dn(P.balance)]})})]})})},{title:"优先级",dataIndex:"priority",render:(v,P,ne)=>e.jsx("div",{children:e.jsx(ku,{style:{width:70},name:"priority",onBlur:ae=>{y(P.id,"priority",P,ae.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:P.priority,min:-999})})},{title:"权重",dataIndex:"weight",render:(v,P,ne)=>e.jsx("div",{children:e.jsx(ku,{style:{width:70},name:"weight",onBlur:ae=>{y(P.id,"weight",P,ae.target.value)},keepFocus:!0,innerButtons:!0,defaultValue:P.weight,min:0})})},{title:"",dataIndex:"operate",render:(v,P,ne)=>e.jsxs("div",{children:[e.jsxs(Xu,{style:{marginRight:1},"aria-label":"测试操作项目组",children:[e.jsx(k,{theme:"light",onClick:()=>{G(P,"")},children:"测试"}),e.jsx(He,{trigger:"click",position:"bottomRight",menu:P.test_models,children:e.jsx(k,{style:{padding:"8px 4px"},type:"primary",icon:e.jsx(et,{})})})]}),e.jsx(ve,{title:"确定是否要删除此渠道？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{y(P.id,"delete",P).then(()=>{m(P.id)})},children:e.jsx(k,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),P.status===1?e.jsx(k,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{y(P.id,"disable",P)},children:"禁用"}):e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{y(P.id,"enable",P)},children:"启用"}),e.jsx(k,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{E(P),T(!0)},children:"编辑"}),e.jsx(ve,{title:"确定是否要复制此渠道？",content:"复制渠道的所有信息",okType:"danger",position:"left",onConfirm:async()=>{h(P.id)},children:e.jsx(k,{theme:"light",type:"primary",style:{marginRight:1},children:"复制"})})]})}],[n,c]=t.useState([]),[s,i]=t.useState(!0),[r,p]=t.useState(1),[C,A]=t.useState(!1),[o,F]=t.useState(""),[l,g]=t.useState(""),[w,O]=t.useState(""),[I,z]=t.useState(!1),[b,J]=t.useState(!1),[S,U]=t.useState(he);t.useState(cn("channel-test"));const[W,q]=t.useState(S),[Z,ue]=t.useState([]),[V,T]=t.useState(!1),[x,M]=t.useState(!1),[H,E]=t.useState({id:void 0}),[a,d]=t.useState([]),m=v=>{let P=[...n];if(v!=null){let ne=P.findIndex(ae=>ae.id===v);ne>-1&&(P.splice(ne,1),c(P))}},B=v=>{for(let P=0;P<v.length;P++){v[P].key=""+v[P].id;let ne=[];v[P].models.split(",").forEach((ae,Fe)=>{ne.push({node:"item",name:ae,onClick:()=>{G(v[P],ae)}})}),v[P].test_models=ne}c(v),v.length>=S?q(v.length+S):q(v.length)},R=async(v,P,ne)=>{i(!0);const ae=await $.get(`/api/channel/?p=${v}&page_size=${P}&id_sort=${ne}`);if(ae===void 0)return;const{success:Fe,message:Ce,data:Re}=ae.data;if(Fe)if(v===0)B(Re);else{let Je=[...n];Je.splice(v*P,Re.length,...Re),B(Je)}else f(Ce);i(!1)},h=async v=>{const P=n.find(ne=>String(ne.id)===String(v));if(console.log(P),P.name+="_复制",P.created_time=null,P.balance=0,P.used_quota=0,!P){f("渠道未找到，请刷新页面后重试。");return}try{const ne={...P,id:void 0},ae=await $.post("/api/channel/",ne);ae.data.success?(Y("渠道复制成功"),await D()):f(ae.data.message)}catch(ne){f("渠道复制失败: "+ne.message)}},D=async()=>{await R(r-1,S,C)};t.useEffect(()=>{const v=localStorage.getItem("id-sort")==="true",P=parseInt(localStorage.getItem("page-size"))||he;A(v),U(P),R(0,P,v).then().catch(ne=>{f(ne)}),Au().then(),Dn().then()},[]);const y=async(v,P,ne,ae)=>{let Fe={id:v},Ce;switch(P){case"delete":Ce=await $.delete(`/api/channel/${v}/`);break;case"enable":Fe.status=1,Ce=await $.put("/api/channel/",Fe);break;case"disable":Fe.status=2,Ce=await $.put("/api/channel/",Fe);break;case"priority":if(ae==="")return;Fe.priority=parseInt(ae),Ce=await $.put("/api/channel/",Fe);break;case"weight":if(ae==="")return;Fe.weight=parseInt(ae),Fe.weight<0&&(Fe.weight=0),Ce=await $.put("/api/channel/",Fe);break}const{success:Re,message:Je}=Ce.data;if(Re){Y("操作成功完成！");let pu=Ce.data.data,Q=[...n];P==="delete"||(ne.status=pu.status),c(Q)}else f(Je)},N=v=>{switch(v){case 1:return e.jsx(_,{size:"large",color:"green",children:"已启用"});case 2:return e.jsx(_,{size:"large",color:"yellow",children:"已禁用"});case 3:return e.jsx(_,{size:"large",color:"yellow",children:"自动禁用"});default:return e.jsx(_,{size:"large",color:"grey",children:"未知状态"})}},X=v=>{let P=v/1e3;return P=P.toFixed(2)+" 秒",v===0?e.jsx(_,{size:"large",color:"grey",children:"未测试"}):v<=1e3?e.jsx(_,{size:"large",color:"green",children:P}):v<=3e3?e.jsx(_,{size:"large",color:"lime",children:P}):v<=5e3?e.jsx(_,{size:"large",color:"yellow",children:P}):e.jsx(_,{size:"large",color:"red",children:P})},j=async(v,P,ne)=>{if(v===""&&P===""&&ne===""){await R(0,S,C),p(1);return}z(!0);const ae=await $.get(`/api/channel/search?keyword=${v}&group=${P}&model=${ne}`),{success:Fe,message:Ce,data:Re}=ae.data;Fe?(c(Re),p(1)):f(Ce),z(!1)},G=async(v,P)=>{const ne=await $.get(`/api/channel/test/${v.id}?model=${P}`),{success:ae,message:Fe,time:Ce}=ne.data;ae?(v.response_time=Ce*1e3,v.test_time=Date.now()/1e3,Be(`通道 ${v.name} 测试成功，耗时 ${Ce.toFixed(2)} 秒。`)):f(Fe)},te=async()=>{const v=await $.get("/api/channel/test"),{success:P,message:ne}=v.data;P?Be("已成功开始测试所有通道，请刷新页面查看结果。"):f(ne)},oe=async()=>{const v=await $.delete("/api/channel/disabled"),{success:P,message:ne,data:ae}=v.data;P?(Y(`已删除所有禁用渠道，共计 ${ae} 个`),await D()):f(ne)},ce=async v=>{const P=await $.get(`/api/channel/update_balance/${v.id}/`),{success:ne,message:ae,balance:Fe}=P.data;ne?(v.balance=Fe,v.balance_updated_time=Date.now()/1e3,Be(`通道 ${v.name} 余额更新成功！`)):f(ae)},le=async()=>{J(!0);const v=await $.get("/api/channel/update_balance"),{success:P,message:ne}=v.data;P?Be("已更新完毕所有已启用通道余额！"):f(ne),J(!1)},Ae=async()=>{if(a.length===0){f("请先选择要删除的通道！");return}i(!0);let v=[];a.forEach(Ce=>{v.push(Ce.id)});const P=await $.post("/api/channel/batch",{ids:v}),{success:ne,message:ae,data:Fe}=P.data;ne?(Y(`已删除 ${Fe} 个通道！`),await D()):f(ae),i(!1)},ke=async()=>{const v=await $.post("/api/channel/fix"),{success:P,message:ne,data:ae}=v.data;P?(Y(`已修复 ${ae} 个通道！`),await D()):f(ne)};let $e=n.slice((r-1)*S,r*S);const Me=v=>{p(v),v===Math.ceil(n.length/S)+1&&R(v-1,S,C).then(P=>{})},tu=async v=>{localStorage.setItem("page-size",v+""),U(v),p(1),R(0,v,C).then().catch(P=>{f(P)})},Au=async()=>{try{let v=await $.get("/api/group/");if(v===void 0)return;ue(v.data.data.map(P=>({label:P,value:P})))}catch(v){f(v.message)}},hu=()=>{T(!1)},Fu=(v,P)=>v.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Mu,{refresh:D,visible:V,handleClose:hu,editingChannel:H}),e.jsx(L,{onSubmit:()=>{j(o,l,w)},labelPosition:"left",children:e.jsx("div",{style:{display:"flex"},children:e.jsxs(de,{children:[e.jsx(L.Input,{field:"search_keyword",label:"搜索渠道关键词",placeholder:"ID，名称和密钥 ...",value:o,loading:I,onChange:v=>{F(v.trim())}}),e.jsx(L.Input,{field:"search_model",label:"模型",placeholder:"模型关键字",value:w,loading:I,onChange:v=>{O(v.trim())}}),e.jsx(L.Select,{field:"group",label:"分组",optionList:Z,onChange:v=>{g(v),j(o,v,w)}}),e.jsx(k,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",style:{marginRight:8},children:"查询"})]})})}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsx(de,{children:e.jsxs(de,{children:[e.jsx(ee.Text,{strong:!0,children:"使用ID排序"}),e.jsx(Tu,{checked:C,label:"使用ID排序",uncheckedText:"关","aria-label":"是否用ID排序",onChange:v=>{localStorage.setItem("id-sort",v+""),A(v),R(0,S,v).then().catch(P=>{f(P)})}})]})})}),e.jsx(uu,{className:"channel-table",style:{marginTop:15},columns:u,dataSource:$e,pagination:{currentPage:r,pageSize:S,total:W,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,formatPageText:v=>"",onPageSizeChange:v=>{tu(v).then()},onPageChange:Me},loading:s,onRow:Fu,rowSelection:x?{onChange:(v,P)=>{d(P)}}:null}),e.jsx("div",{style:{display:we()?"":"flex",marginTop:we()?0:-45,zIndex:999,position:"relative",pointerEvents:"none"},children:e.jsxs(de,{style:{pointerEvents:"auto",marginTop:we()?0:45},children:[e.jsx(k,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{E({id:void 0}),T(!0)},children:"添加渠道"}),e.jsx(ve,{title:"确定？",okType:"warning",onConfirm:te,position:(we(),"top"),children:e.jsx(k,{theme:"light",type:"warning",style:{marginRight:8},children:"测试所有通道"})}),e.jsx(ve,{title:"确定？",okType:"secondary",onConfirm:le,children:e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:8},children:"更新所有已启用通道余额"})}),e.jsx(ve,{title:"确定是否要删除禁用通道？",content:"此修改将不可逆",okType:"danger",onConfirm:oe,children:e.jsx(k,{theme:"light",type:"danger",style:{marginRight:8},children:"删除禁用通道"})}),e.jsx(k,{theme:"light",type:"primary",style:{marginRight:8},onClick:D,children:"刷新"})]})}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(de,{children:[e.jsx(ee.Text,{strong:!0,children:"开启批量删除"}),e.jsx(Tu,{label:"开启批量删除",uncheckedText:"关","aria-label":"是否开启批量删除",onChange:v=>{M(v)}}),e.jsx(ve,{title:"确定是否要删除所选通道？",content:"此修改将不可逆",okType:"danger",onConfirm:Ae,disabled:!x,position:"top",children:e.jsx(k,{disabled:!x,theme:"light",type:"danger",style:{marginRight:8},children:"删除所选通道"})}),e.jsx(ve,{title:"确定是否要修复数据库一致性？",content:"进行该操作时，可能导致渠道访问错误，请仅在数据库出现问题时使用",okType:"warning",onConfirm:ke,position:"top",children:e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:8},children:"修复数据库一致性"})})]})})]})},Zn=()=>e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsx(re.Header,{children:e.jsx("h3",{children:"管理渠道"})}),e.jsx(re.Content,{children:e.jsx(Yn,{})})]})}),Xn=u=>{const[n,c]=t.useState(!1),[s,i]=t.useState(n),r={name:"",remain_quota:n?0:5e5,expired_time:-1,unlimited_quota:!1,model_limits_enabled:!1,model_limits:[]},[p,C]=t.useState(r),{name:A,remain_quota:o,expired_time:F,unlimited_quota:l,model_limits_enabled:g,model_limits:w}=p,[O,I]=t.useState({});Pe();const z=(x,M)=>{C(H=>({...H,[x]:M}))},b=()=>{u.handleClose()},J=(x,M,H,E)=>{let d=new Date().getTime()/1e3,m=x*30*24*60*60;m+=M*24*60*60,m+=H*60*60,m+=E*60,m!==0?(d+=m,C({...p,expired_time:Le(d)})):C({...p,expired_time:-1})},S=()=>{C({...p,unlimited_quota:!l})},U=async()=>{let x=await $.get("/api/user/models");const{success:M,message:H,data:E}=x.data;if(M){let a=E.map(d=>({label:d,value:d}));I(a)}else f(H)},W=async()=>{i(!0);let x=await $.get(`/api/token/${u.editingToken.id}`);const{success:M,message:H,data:E}=x.data;M?(E.expired_time!==-1&&(E.expired_time=Le(E.expired_time)),E.model_limits!==""?E.model_limits=E.model_limits.split(","):E.model_limits=[],C(E)):f(H),i(!1)};t.useEffect(()=>{c(u.editingToken.id!==void 0)},[u.editingToken.id]),t.useEffect(()=>{n?W().then(()=>{}):C(r),U()},[n]);const[q,Z]=t.useState(1),ue=x=>{const M=parseInt(x,10);!isNaN(M)&&M>0&&Z(M)},V=()=>{const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let M="";for(let H=0;H<6;H++)M+=x.charAt(Math.floor(Math.random()*x.length));return M},T=async()=>{if(i(!0),n){let x={...p};if(x.remain_quota=parseInt(x.remain_quota),x.expired_time!==-1){let a=Date.parse(x.expired_time);if(isNaN(a)){f("过期时间格式错误！"),i(!1);return}x.expired_time=Math.ceil(a/1e3)}x.model_limits=x.model_limits.join(",");let M=await $.put("/api/token/",{...x,id:parseInt(u.editingToken.id)});const{success:H,message:E}=M.data;H?(Y("令牌更新成功！"),u.refresh(),u.handleClose()):f(E)}else{let x=0;for(let M=0;M<q;M++){let H={...p};if(M!==0&&(H.name=`${p.name}-${V()}`),H.remain_quota=parseInt(H.remain_quota),H.expired_time!==-1){let m=Date.parse(H.expired_time);if(isNaN(m)){f("过期时间格式错误！"),i(!1);break}H.expired_time=Math.ceil(m/1e3)}H.model_limits=H.model_limits.join(",");let E=await $.post("/api/token/",H);const{success:a,message:d}=E.data;if(a)x++;else{f(d);break}}x>0&&(Y(`${x}个令牌创建成功，请在列表页面点击复制获取令牌！`),u.refresh(),u.handleClose())}i(!1),C(r),Z(1)};return e.jsx(e.Fragment,{children:e.jsx(cu,{placement:n?"right":"left",title:e.jsx(eu,{level:3,children:n?"更新令牌信息":"创建新的令牌"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(k,{theme:"solid",size:"large",onClick:T,children:"提交"}),e.jsx(k,{theme:"solid",size:"large",type:"tertiary",onClick:b,children:"取消"})]})}),closeIcon:null,onCancel:()=>b(),width:we()?"100%":600,children:e.jsxs(De,{spinning:s,children:[e.jsx(se,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:x=>z("name",x),value:A,autoComplete:"new-password",required:!n}),e.jsx(Se,{}),e.jsx(_t,{label:"过期时间",name:"expired_time",placeholder:"请选择过期时间",onChange:x=>z("expired_time",x),value:F,autoComplete:"new-password",type:"dateTime"}),e.jsx("div",{style:{marginTop:20},children:e.jsxs(de,{children:[e.jsx(k,{type:"tertiary",onClick:()=>{J(0,0,0,0)},children:"永不过期"}),e.jsx(k,{type:"tertiary",onClick:()=>{J(0,0,1,0)},children:"一小时"}),e.jsx(k,{type:"tertiary",onClick:()=>{J(1,0,0,0)},children:"一个月"}),e.jsx(k,{type:"tertiary",onClick:()=>{J(0,1,0,0)},children:"一天"})]})}),e.jsx(Se,{}),e.jsx(Xe,{type:"warning",description:"注意，令牌的额度仅用于限制令牌本身的最大额度使用量，实际的使用受到账户的剩余额度限制。"}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:`额度${lu(o)}`})}),e.jsx(Iu,{style:{marginTop:8},name:"remain_quota",placeholder:"请输入额度",onChange:x=>z("remain_quota",x),value:o,autoComplete:"new-password",type:"number",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}],disabled:l}),!n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:"新建数量"})}),e.jsx(Iu,{style:{marginTop:8},label:"数量",placeholder:"请选择或输入创建令牌的数量",onChange:x=>ue(x),onSelect:x=>ue(x),value:q.toString(),autoComplete:"off",type:"number",data:[{value:10,label:"10个"},{value:20,label:"20个"},{value:30,label:"30个"},{value:100,label:"100个"}],disabled:l})]}),e.jsx("div",{children:e.jsx(k,{style:{marginTop:8},type:"warning",onClick:()=>{S()},children:l?"取消无限额度":"设为无限额度"})}),e.jsx(Se,{}),e.jsx("div",{style:{marginTop:10,display:"flex"},children:e.jsxs(de,{children:[e.jsx(_u,{name:"model_limits_enabled",checked:g,onChange:x=>z("model_limits_enabled",x.target.checked)}),e.jsx(ee.Text,{children:"启用模型限制（非必要，不建议启用）"})]})}),e.jsx(Te,{style:{marginTop:8},placeholder:"请选择该渠道所支持的模型",name:"models",required:!0,multiple:!0,selection:!0,onChange:x=>{z("model_limits",x)},value:p.model_limits,autoComplete:"new-password",optionList:O,disabled:!g})]})})})};function Qu(u){return e.jsx(e.Fragment,{children:Le(u)})}function es(u,n=!1){switch(u){case 1:return n?e.jsx(_,{color:"green",size:"large",children:"已启用：限制模型"}):e.jsx(_,{color:"green",size:"large",children:"已启用"});case 2:return e.jsxs(_,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(_,{color:"yellow",size:"large",children:[" ","已过期"," "]});case 4:return e.jsxs(_,{color:"grey",size:"large",children:[" ","已耗尽"," "]});default:return e.jsxs(_,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const us=()=>{const u=[{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(y,N,X)=>e.jsx("div",{children:es(y,N.model_limits_enabled)})},{title:"已用额度",dataIndex:"used_quota",render:(y,N,X)=>e.jsx("div",{children:ge(parseInt(y))})},{title:"剩余额度",dataIndex:"remain_quota",render:(y,N,X)=>e.jsx("div",{children:N.unlimited_quota?e.jsx(_,{size:"large",color:"white",children:"无限制"}):e.jsx(_,{size:"large",color:"light-blue",children:ge(parseInt(y))})})},{title:"创建时间",dataIndex:"created_time",render:(y,N,X)=>e.jsx("div",{children:Qu(y)})},{title:"过期时间",dataIndex:"expired_time",render:(y,N,X)=>e.jsx("div",{children:N.expired_time===-1?"永不过期":Qu(y)})},{title:"",dataIndex:"operate",render:(y,N,X)=>e.jsxs("div",{children:[e.jsx(ut,{content:"sk-"+N.key,style:{padding:20},position:"top",children:e.jsx(k,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async j=>{await M("sk-"+N.key)},children:"复制"}),e.jsxs(Xu,{style:{marginRight:1},"aria-label":"项目操作按钮组",children:[e.jsx(k,{theme:"light",style:{color:"rgba(var(--semi-teal-7), 1)"},onClick:()=>{H("next",N.key)},children:"聊天"}),e.jsx(He,{trigger:"click",position:"bottomRight",menu:[{node:"item",key:"next",disabled:!localStorage.getItem("chat_link"),name:"ChatGPT Next Web",onClick:()=>{H("next",N.key)}},{node:"item",key:"next-mj",disabled:!localStorage.getItem("chat_link2"),name:"ChatGPT Web & Midjourney",onClick:()=>{H("next-mj",N.key)}},{node:"item",key:"ama",name:"AMA 问天（BotGem）",onClick:()=>{H("ama",N.key)}},{node:"item",key:"opencat",name:"OpenCat",onClick:()=>{H("opencat",N.key)}}],children:e.jsx(k,{style:{padding:"8px 4px",color:"rgba(var(--semi-teal-7), 1)"},type:"primary",icon:e.jsx(et,{})})})]}),e.jsx(ve,{title:"确定是否要删除此令牌？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{a(N.id,"delete",N).then(()=>{E(N.key)})},children:e.jsx(k,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),N.status===1?e.jsx(k,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{a(N.id,"disable",N)},children:"禁用"}):e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{a(N.id,"enable",N)},children:"启用"}),e.jsx(k,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{q(N),i(!0)},children:"编辑"})]})}],[n,c]=t.useState(he),[s,i]=t.useState(!1),[r,p]=t.useState([]),[C,A]=t.useState([]),[o,F]=t.useState(n),[l,g]=t.useState(!0),[w,O]=t.useState(1),[I,z]=t.useState(""),[b,J]=t.useState(""),[S,U]=t.useState(!1);t.useState(!1),t.useState(0);const[W,q]=t.useState({id:void 0}),Z=()=>{i(!1),setTimeout(()=>{q({id:void 0})},500)},ue=y=>{p(y),y.length>=n?F(y.length+n):F(y.length)};let V=r.slice((w-1)*n,w*n);const T=async y=>{g(!0);const N=await $.get(`/api/token/?p=${y}&size=${n}`),{success:X,message:j,data:G}=N.data;if(X)if(y===0)ue(G);else{let te=[...r];te.splice(y*n,G.length,...G),ue(te)}else f(j);g(!1)},x=async()=>{await T(w-1)},M=async y=>{await ze(y)?Y("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:y,size:"large"})},H=async(y,N)=>{let X=localStorage.getItem("status"),j="";X&&(X=JSON.parse(X),j=X.server_address),j===""&&(j=window.location.origin);let G=encodeURIComponent(j);const te=localStorage.getItem("chat_link"),oe=localStorage.getItem("chat_link2");let ce;te&&(ce=te+`/#/?settings={"key":"sk-${N}","url":"${j}"}`);let le;switch(y){case"ama":le=`ama://set-api-key?server=${G}&key=sk-${N}`;break;case"opencat":le=`opencat://team/join?domain=${G}&token=sk-${N}`;break;case"next-mj":le=oe+`/#/?settings={"key":"sk-${N}","url":"${j}"}`;break;default:if(!te){f("管理员未设置聊天链接");return}le=ce}window.open(le,"_blank")};t.useEffect(()=>{T(0).then().catch(y=>{f(y)})},[n]);const E=y=>{let N=[...r];if(y!=null){let X=N.findIndex(j=>j.key===y);X>-1&&(N.splice(X,1),ue(N))}},a=async(y,N,X)=>{g(!0);let j={id:y},G;switch(N){case"delete":G=await $.delete(`/api/token/${y}/`);break;case"enable":j.status=1,G=await $.put("/api/token/?status_only=true",j);break;case"disable":j.status=2,G=await $.put("/api/token/?status_only=true",j);break}const{success:te,message:oe}=G.data;if(te){Y("操作成功完成！");let ce=G.data.data,le=[...r];N==="delete"||(X.status=ce.status),ue(le)}else f(oe);g(!1)},d=async()=>{if(I===""&&b===""){await T(0),O(1);return}U(!0);const y=await $.get(`/api/token/search?keyword=${I}&token=${b}`),{success:N,message:X,data:j}=y.data;N?(ue(j),O(1)):f(X),U(!1)},m=async y=>{z(y.trim())},B=async y=>{J(y.trim())},R=y=>{O(y),y===Math.ceil(r.length/n)+1&&T(y-1).then(N=>{})},h={onSelect:(y,N)=>{},onSelectAll:(y,N)=>{},onChange:(y,N)=>{A(N)}},D=(y,N)=>y.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(Xn,{refresh:x,editingToken:W,visiable:s,handleClose:Z}),e.jsxs(L,{layout:"horizontal",style:{marginTop:10},labelPosition:"left",children:[e.jsx(L.Input,{field:"keyword",label:"搜索关键字",placeholder:"令牌名称",value:I,loading:S,onChange:m}),e.jsx(L.Input,{field:"token",label:"Key",placeholder:"密钥",value:b,loading:S,onChange:B}),e.jsx(k,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:d,style:{marginRight:8},children:"查询"})]}),e.jsx(uu,{style:{marginTop:20},columns:u,dataSource:V,pagination:{currentPage:w,pageSize:n,total:o,showSizeChanger:!0,pageSizeOptions:[10,20,50,100],formatPageText:y=>`第 ${y.currentStart} - ${y.currentEnd} 条，共 ${r.length} 条`,onPageSizeChange:y=>{c(y),O(1)},onPageChange:R},loading:l,rowSelection:h,onRow:D}),e.jsx(k,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{q({id:void 0}),i(!0)},children:"添加令牌"}),e.jsx(k,{label:"复制所选令牌",type:"warning",onClick:async()=>{if(C.length===0){f("请至少选择一个令牌！");return}let y="";for(let N=0;N<C.length;N++)y+=C[N].name+"    sk-"+C[N].key+`
`;await M(y)},children:"复制所选令牌到剪贴板"})]})},ts=()=>e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsx(re.Header,{children:e.jsx("h3",{children:"我的令牌"})}),e.jsx(re.Content,{children:e.jsx(us,{})})]})}),ns=u=>{const n=u.editingRedemption.id!==void 0,[c,s]=t.useState(n);Bt(),Pe();const i={name:"",quota:1e5,count:1},[r,p]=t.useState(i),{name:C,quota:A,count:o}=r,F=()=>{u.handleClose()},l=(O,I)=>{p(z=>({...z,[O]:I}))},g=async()=>{s(!0);let O=await $.get(`/api/redemption/${u.editingRedemption.id}`);const{success:I,message:z,data:b}=O.data;I?p(b):f(z),s(!1)};t.useEffect(()=>{n?g().then(()=>{}):p(i)},[u.editingRedemption.id]);const w=async()=>{if(!n&&r.name==="")return;s(!0);let O=r;O.count=parseInt(O.count),O.quota=parseInt(O.quota);let I;n?I=await $.put("/api/redemption/",{...O,id:parseInt(u.editingRedemption.id)}):I=await $.post("/api/redemption/",{...O});const{success:z,message:b,data:J}=I.data;if(z?n?(Y("兑换码更新成功！"),u.refresh(),u.handleClose()):(Y("兑换码创建成功！"),p(i),u.refresh(),u.handleClose()):f(b),!n&&J){let S="";for(let U=0;U<J.length;U++)S+=J[U]+`
`;fe.confirm({title:"兑换码创建成功",content:e.jsxs("div",{children:[e.jsx("p",{children:"兑换码创建成功，是否下载兑换码？"}),e.jsx("p",{children:"兑换码将以文本文件的形式下载，文件名为兑换码的名称。"})]}),onOk:()=>{on(S,`${r.name}.txt`)}})}s(!1)};return e.jsx(e.Fragment,{children:e.jsx(cu,{placement:n?"right":"left",title:e.jsx(eu,{level:3,children:n?"更新兑换码信息":"创建新的兑换码"}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},visible:u.visiable,footer:e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsxs(de,{children:[e.jsx(k,{theme:"solid",size:"large",onClick:w,children:"提交"}),e.jsx(k,{theme:"solid",size:"large",type:"tertiary",onClick:F,children:"取消"})]})}),closeIcon:null,onCancel:()=>F(),width:we()?"100%":600,children:e.jsxs(De,{spinning:c,children:[e.jsx(se,{style:{marginTop:20},label:"名称",name:"name",placeholder:"请输入名称",onChange:O=>l("name",O),value:C,autoComplete:"new-password",required:!n}),e.jsx(Se,{}),e.jsx("div",{style:{marginTop:20},children:e.jsx(ee.Text,{children:`额度${lu(A)}`})}),e.jsx(Iu,{style:{marginTop:8},name:"quota",placeholder:"请输入额度",onChange:O=>l("quota",O),value:A,autoComplete:"new-password",type:"number",position:"bottom",data:[{value:5e5,label:"1$"},{value:5e6,label:"10$"},{value:25e6,label:"50$"},{value:5e7,label:"100$"},{value:25e7,label:"500$"},{value:5e8,label:"1000$"}]}),!n&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsx(ee.Text,{children:"生成数量"}),e.jsx(se,{style:{marginTop:8},label:"生成数量",name:"count",placeholder:"请输入生成数量",onChange:O=>l("count",O),value:o,autoComplete:"new-password",type:"number"})]})]})})})};function ss(u){return e.jsx(e.Fragment,{children:Le(u)})}function as(u){switch(u){case 1:return e.jsx(_,{color:"green",size:"large",children:"未使用"});case 2:return e.jsxs(_,{color:"red",size:"large",children:[" ","已禁用"," "]});case 3:return e.jsxs(_,{color:"grey",size:"large",children:[" ","已使用"," "]});default:return e.jsxs(_,{color:"black",size:"large",children:[" ","未知状态"," "]})}}const rs=()=>{const u=[{title:"ID",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"状态",dataIndex:"status",key:"status",render:(d,m,B)=>e.jsx("div",{children:as(d)})},{title:"额度",dataIndex:"quota",render:(d,m,B)=>e.jsx("div",{children:ge(parseInt(d))})},{title:"创建时间",dataIndex:"created_time",render:(d,m,B)=>e.jsx("div",{children:ss(d)})},{title:"兑换人ID",dataIndex:"used_user_id",render:(d,m,B)=>e.jsx("div",{children:d===0?"无":d})},{title:"",dataIndex:"operate",render:(d,m,B)=>e.jsxs("div",{children:[e.jsx(ut,{content:m.key,style:{padding:20},position:"top",children:e.jsx(k,{theme:"light",type:"tertiary",style:{marginRight:1},children:"查看"})}),e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async R=>{await Z(m.key)},children:"复制"}),e.jsx(ve,{title:"确定是否要删除此兑换码？",content:"此修改将不可逆",okType:"danger",position:"left",onConfirm:()=>{V(m.id,"delete",m).then(()=>{q(m.key)})},children:e.jsx(k,{theme:"light",type:"danger",style:{marginRight:1},children:"删除"})}),m.status===1?e.jsx(k,{theme:"light",type:"warning",style:{marginRight:1},onClick:async()=>{V(m.id,"disable",m)},children:"禁用"}):e.jsx(k,{theme:"light",type:"secondary",style:{marginRight:1},onClick:async()=>{V(m.id,"enable",m)},disabled:m.status===3,children:"启用"}),e.jsx(k,{theme:"light",type:"tertiary",style:{marginRight:1},onClick:()=>{z(m),J(!0)},disabled:m.status!==1,children:"编辑"})]})}],[n,c]=t.useState([]),[s,i]=t.useState(!0),[r,p]=t.useState(1),[C,A]=t.useState(""),[o,F]=t.useState(!1),[l,g]=t.useState(he),[w,O]=t.useState([]),[I,z]=t.useState({id:void 0}),[b,J]=t.useState(!1),S=()=>{J(!1)},U=d=>{c(d),d.length>=r*he?g(d.length+1):g(d.length)},W=async d=>{const m=await $.get(`/api/redemption/?p=${d}`),{success:B,message:R,data:h}=m.data;if(B)if(d===0)U(h);else{let D=n;D.push(...h),U(D)}else f(R);i(!1)},q=d=>{let m=[...n];if(d!=null){let B=m.findIndex(R=>R.key===d);B>-1&&(m.splice(B,1),c(m))}},Z=async d=>{await ze(d)?Y("已复制到剪贴板！"):fe.error({title:"无法复制到剪贴板，请手动复制",content:d})};t.useEffect(()=>{W(0).then().catch(d=>{f(d)})},[]);const ue=async()=>{await W(r-1)},V=async(d,m,B)=>{let R={id:d},h;switch(m){case"delete":h=await $.delete(`/api/redemption/${d}/`);break;case"enable":R.status=1,h=await $.put("/api/redemption/?status_only=true",R);break;case"disable":R.status=2,h=await $.put("/api/redemption/?status_only=true",R);break}const{success:D,message:y}=h.data;if(D){Y("操作成功完成！");let N=h.data.data,X=[...n];m==="delete"||(B.status=N.status),c(X)}else f(y)},T=async()=>{if(C===""){await W(0),p(1);return}F(!0);const d=await $.get(`/api/redemption/search?keyword=${C}`),{success:m,message:B,data:R}=d.data;m?(c(R),p(1)):f(B),F(!1)},x=async d=>{A(d.trim())},M=d=>{p(d),d===Math.ceil(n.length/he)+1&&W(d-1).then(m=>{})};let H=n.slice((r-1)*he,r*he);const E={onSelect:(d,m)=>{},onSelectAll:(d,m)=>{},onChange:(d,m)=>{O(m)}},a=(d,m)=>d.status!==1?{style:{background:"var(--semi-color-disabled-border)"}}:{};return e.jsxs(e.Fragment,{children:[e.jsx(ns,{refresh:ue,editingRedemption:I,visiable:b,handleClose:S}),e.jsx(L,{onSubmit:T,children:e.jsx(L.Input,{label:"搜索关键字",field:"keyword",icon:"search",iconPosition:"left",placeholder:"关键字(id或者名称)",value:C,loading:o,onChange:x})}),e.jsx(uu,{style:{marginTop:20},columns:u,dataSource:H,pagination:{currentPage:r,pageSize:he,total:l,formatPageText:d=>`第 ${d.currentStart} - ${d.currentEnd} 条，共 ${n.length} 条`,onPageChange:M},loading:s,rowSelection:E,onRow:a}),e.jsx(k,{theme:"light",type:"primary",style:{marginRight:8},onClick:()=>{z({id:void 0}),J(!0)},children:"添加兑换码"}),e.jsx(k,{label:"复制所选兑换码",type:"warning",onClick:async()=>{if(w.length===0){f("请至少选择一个兑换码！");return}let d="";for(let m=0;m<w.length;m++)d+=w[m].name+"    "+w[m].key+`
`;await Z(d)},children:"复制所选兑换码到剪贴板"})]})},is=()=>e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsx(re.Header,{children:e.jsx("h3",{children:"管理兑换码"})}),e.jsx(re.Content,{children:e.jsx(rs,{})})]})}),ls=()=>{const[u,n]=t.useState(""),[c,s]=t.useState(""),[i,r]=t.useState(0);t.useState(1);const[p,C]=t.useState(0),[A,o]=t.useState(1),[F,l]=t.useState(""),[g,w]=t.useState(!1),[O,I]=t.useState(0),[z,b]=t.useState(!1),[J,S]=t.useState(!1),[U,W]=t.useState(""),q=async()=>{if(u===""){Be("请输入兑换码！");return}b(!0);try{const E=await $.post("/api/user/topup",{key:u}),{success:a,message:d,data:m}=E.data;a?(Y("兑换成功！"),fe.success({title:"兑换成功！",content:"成功兑换额度："+ge(m),centered:!0}),I(B=>B+m),n("")):f(d)}catch{f("请求失败")}finally{b(!1)}},Z=()=>{if(!F){f("超级管理员未设置充值链接！");return}window.open(F,"_blank")},ue=async E=>{if(!g){f("管理员未开启在线充值！");return}if(await M(),i<A){f("充值数量不能小于"+A);return}W(E),S(!0)},V=async()=>{if(p===0&&await M(),i<A){f("充值数量不能小于"+A);return}S(!1);try{const E=await $.post("/api/user/pay",{amount:parseInt(i),top_up_code:c,payment_method:U});if(E!==void 0){const{message:a,data:d}=E.data;if(a==="success"){let m=d,B=E.data.url,R=document.createElement("form");R.action=B,R.method="POST",navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")<1||(R.target="_blank");for(let D in m){let y=document.createElement("input");y.type="hidden",y.name=D,y.value=m[D],R.appendChild(y)}document.body.appendChild(R),R.submit(),document.body.removeChild(R)}else f(d)}else f(E)}catch(E){console.log(E)}finally{}},T=async()=>{let E=await $.get("/api/user/self");const{success:a,message:d,data:m}=E.data;a?I(m.quota):f(d)};t.useEffect(()=>{let E=localStorage.getItem("status");E&&(E=JSON.parse(E),E.top_up_link&&l(E.top_up_link),E.min_topup&&o(E.min_topup),E.enable_online_topup&&w(E.enable_online_topup)),T().then()},[]);const x=()=>p+"元",M=async E=>{E===void 0&&(E=i);try{const a=await $.post("/api/user/amount",{amount:parseFloat(E),top_up_code:c});if(a!==void 0){const{message:d,data:m}=a.data;d==="success"?C(parseFloat(m)):(C(0),_e.error({content:"错误："+m,id:"getAmount"}))}else f(a)}catch(a){console.log(a)}finally{}},H=()=>{S(!1)};return e.jsx("div",{children:e.jsxs(re,{children:[e.jsx(re.Header,{children:e.jsx("h3",{children:"我的钱包"})}),e.jsxs(re.Content,{children:[e.jsxs(fe,{title:"确定要充值吗",visible:J,onOk:V,onCancel:H,maskClosable:!1,size:"small",centered:!0,children:[e.jsxs("p",{children:["充值数量：",i]}),e.jsxs("p",{children:["实付金额：",x()]}),e.jsx("p",{children:"是否确认充值？"})]}),e.jsx("div",{style:{marginTop:20,display:"flex",justifyContent:"center"},children:e.jsxs(be,{style:{width:"500px",padding:"20px"},children:[e.jsxs(eu,{level:3,style:{textAlign:"center"},children:["余额 ",ge(O)]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Eu,{children:"兑换余额"}),e.jsxs(L,{children:[e.jsx(L.Input,{field:"redemptionCode",label:"兑换码",placeholder:"兑换码",name:"redemptionCode",value:u,onChange:E=>{n(E)}}),e.jsxs(de,{children:[F?e.jsx(k,{type:"primary",theme:"solid",onClick:Z,children:"获取兑换码"}):null,e.jsx(k,{type:"warning",theme:"solid",onClick:q,disabled:z,children:z?"兑换中...":"兑换"})]})]})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx(Eu,{children:"在线充值"}),e.jsxs(L,{children:[e.jsx(L.Input,{disabled:!g,field:"redemptionCount",label:"实付金额："+x(),placeholder:"充值数量，最低 "+Fn(A),name:"redemptionCount",type:"number",value:i,onChange:async E=>{E<1&&(E=1),r(E),await M(E)}}),e.jsxs(de,{children:[e.jsx(k,{type:"primary",theme:"solid",onClick:async()=>{ue("zfb")},children:"支付宝"}),e.jsx(k,{style:{backgroundColor:"rgba(var(--semi-green-5), 1)"},type:"primary",theme:"solid",onClick:async()=>{ue("wx")},children:"微信"})]})]})]})]})})]})]})})},{Header:os}=re,Ju=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function cs(u){switch(u){case 1:return e.jsxs(_,{color:"cyan",size:"large",children:[" ","充值"," "]});case 2:return e.jsxs(_,{color:"lime",size:"large",children:[" ","消费"," "]});case 3:return e.jsxs(_,{color:"orange",size:"large",children:[" ","管理"," "]});case 4:return e.jsxs(_,{color:"purple",size:"large",children:[" ","系统"," "]});default:return e.jsxs(_,{color:"black",size:"large",children:[" ","未知"," "]})}}function ds(u){return u?e.jsx(_,{color:"blue",size:"large",children:"流"}):e.jsx(_,{color:"purple",size:"large",children:"非流"})}function hs(u){const n=parseInt(u);return n<101?e.jsxs(_,{color:"green",size:"large",children:[" ",n," s"," "]}):n<300?e.jsxs(_,{color:"orange",size:"large",children:[" ",n," s"," "]}):e.jsxs(_,{color:"red",size:"large",children:[" ",n," s"," "]})}const Fs=()=>{const u=[{title:"时间",dataIndex:"timestamp2string"},{title:"渠道",dataIndex:"channel",className:Ie()?"tableShow":"tableHiddle",render:(j,G,te)=>b?G.type===0||G.type===2?e.jsx("div",{children:e.jsxs(_,{color:Ju[parseInt(j)%Ju.length],size:"large",children:[" ",j," "]})}):e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{})},{title:"用户",dataIndex:"username",className:Ie()?"tableShow":"tableHiddle",render:(j,G,te)=>b?e.jsxs("div",{children:[e.jsx(Ou,{size:"small",color:ru(j),style:{marginRight:4},onClick:()=>m(G.user_id),children:typeof j=="string"&&j.slice(0,1)}),j]}):e.jsx(e.Fragment,{})},{title:"令牌",dataIndex:"token_name",render:(j,G,te)=>G.type===0||G.type===2?e.jsx("div",{children:e.jsxs(_,{color:"grey",size:"large",onClick:()=>{X(j)},children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"类型",dataIndex:"type",render:(j,G,te)=>e.jsx("div",{children:cs(j)})},{title:"模型",dataIndex:"model_name",render:(j,G,te)=>G.type===0||G.type===2?e.jsx("div",{children:e.jsxs(_,{color:ru(j),size:"large",onClick:()=>{X(j)},children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"用时",dataIndex:"use_time",render:(j,G,te)=>e.jsx("div",{children:e.jsxs(de,{children:[hs(j),ds(G.is_stream)]})})},{title:"提示",dataIndex:"prompt_tokens",render:(j,G,te)=>G.type===0||G.type===2?e.jsx("div",{children:e.jsxs("span",{children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"补全",dataIndex:"completion_tokens",render:(j,G,te)=>parseInt(j)>0&&(G.type===0||G.type===2)?e.jsx("div",{children:e.jsxs("span",{children:[" ",j," "]})}):e.jsx(e.Fragment,{})},{title:"花费",dataIndex:"quota",render:(j,G,te)=>G.type===0||G.type===2?e.jsx("div",{children:ge(j,6)}):e.jsx(e.Fragment,{})},{title:"详情",dataIndex:"content",render:(j,G,te)=>{if(G.other==="")return e.jsx(Nu,{ellipsis:{rows:2,showTooltip:{type:"popover",opts:{style:{width:240}}}},style:{maxWidth:240},children:j});let oe=JSON.parse(G.other),ce=pn(G.prompt_tokens,G.completion_tokens,oe.model_ratio,oe.model_price,oe.completion_ratio,oe.group_ratio);return e.jsx(Oe,{content:ce,children:e.jsx(Nu,{ellipsis:{rows:2},style:{maxWidth:240},children:j})})}}],[n,c]=t.useState([]),[s,i]=t.useState(!1),[r,p]=t.useState(!1),[C,A]=t.useState(!1),[o,F]=t.useState(1),[l,g]=t.useState(he),[w,O]=t.useState(he);t.useState(""),t.useState(!1);const[I,z]=t.useState(0),b=Ie();let J=new Date;const[S,U]=t.useState({username:"",token_name:"",model_name:"",start_timestamp:Le(J.getTime()/1e3-86400),end_timestamp:Le(J.getTime()/1e3+3600),channel:""}),{username:W,token_name:q,model_name:Z,start_timestamp:ue,end_timestamp:V,channel:T}=S,[x,M]=t.useState({quota:0,token:0}),H=(j,G)=>{U(te=>({...te,[G]:j}))},E=async()=>{let j=Date.parse(ue)/1e3,G=Date.parse(V)/1e3,te=await $.get(`/api/log/self/stat?type=${I}&token_name=${q}&model_name=${Z}&start_timestamp=${j}&end_timestamp=${G}`);const{success:oe,message:ce,data:le}=te.data;oe?M(le):f(ce)},a=async()=>{let j=Date.parse(ue)/1e3,G=Date.parse(V)/1e3,te=await $.get(`/api/log/stat?type=${I}&username=${W}&token_name=${q}&model_name=${Z}&start_timestamp=${j}&end_timestamp=${G}&channel=${T}`);const{success:oe,message:ce,data:le}=te.data;oe?M(le):f(ce)},d=async()=>{A(!0),b?await a():await E(),i(!0),A(!1)},m=async j=>{if(!b)return;const G=await $.get(`/api/user/${j}`),{success:te,message:oe,data:ce}=G.data;te?fe.info({title:"用户信息",content:e.jsxs("div",{style:{padding:12},children:[e.jsxs("p",{children:["用户名: ",ce.username]}),e.jsxs("p",{children:["余额: ",ge(ce.quota)]}),e.jsxs("p",{children:["已用额度：",ge(ce.used_quota)]}),e.jsxs("p",{children:["请求次数：",ju(ce.request_count)]})]}),centered:!0}):f(oe)},B=j=>{for(let G=0;G<j.length;G++)j[G].timestamp2string=Le(j[G].created_at),j[G].key=""+j[G].id;c(j),g(j.length+he)},R=async(j,G,te=0)=>{p(!0);let oe="",ce=Date.parse(ue)/1e3,le=Date.parse(V)/1e3;b?oe=`/api/log/?p=${j}&page_size=${G}&type=${te}&username=${W}&token_name=${q}&model_name=${Z}&start_timestamp=${ce}&end_timestamp=${le}&channel=${T}`:oe=`/api/log/self/?p=${j}&page_size=${G}&type=${te}&token_name=${q}&model_name=${Z}&start_timestamp=${ce}&end_timestamp=${le}`;const Ae=await $.get(oe),{success:ke,message:$e,data:Me}=Ae.data;if(ke)if(j===0)B(Me);else{let tu=[...n];tu.splice(j*G,Me.length,...Me),B(tu)}else f($e);p(!1)},h=n.slice((o-1)*w,o*w),D=j=>{F(j),j===Math.ceil(n.length/w)+1&&R(j-1,w,I).then(G=>{})},y=async j=>{localStorage.setItem("page-size",j+""),O(j),F(1),R(0,j).then().catch(G=>{f(G)})},N=async()=>{F(1),await R(0,w,I)},X=async j=>{await ze(j)?Y("已复制："+j):fe.error({title:"无法复制到剪贴板，请手动复制",content:j})};return t.useEffect(()=>{const j=parseInt(localStorage.getItem("page-size"))||he;O(j),R(0,j).then().catch(G=>{f(G)})},[]),e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsx(os,{children:e.jsx(De,{spinning:C,children:e.jsxs("h3",{children:["使用明细（总消耗额度：",e.jsx("span",{onClick:d,style:{cursor:"pointer",color:"gray"},children:s?ge(x.quota):"点击查看"}),"）"]})})}),e.jsx(L,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(L.Input,{field:"token_name",label:"令牌名称",style:{width:176},value:q,placeholder:"可选值",name:"token_name",onChange:j=>H(j,"token_name")}),e.jsx(L.Input,{field:"model_name",label:"模型名称",style:{width:176},value:Z,placeholder:"可选值",name:"model_name",onChange:j=>H(j,"model_name")}),e.jsx(L.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:ue,value:ue,type:"dateTime",name:"start_timestamp",onChange:j=>H(j,"start_timestamp")}),e.jsx(L.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:V,value:V,type:"dateTime",name:"end_timestamp",onChange:j=>H(j,"end_timestamp")}),b&&e.jsxs(e.Fragment,{children:[e.jsx(L.Input,{field:"channel",label:"渠道 ID",style:{width:176},value:T,placeholder:"可选值",name:"channel",onChange:j=>H(j,"channel")}),e.jsx(L.Input,{field:"username",label:"用户名称",style:{width:176},value:W,placeholder:"可选值",name:"username",onChange:j=>H(j,"username")})]}),e.jsx(L.Section,{children:e.jsx(k,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:N,loading:r,children:"查询"})})]})}),e.jsx(uu,{style:{marginTop:5},columns:u,dataSource:h,pagination:{currentPage:o,pageSize:w,total:l,pageSizeOpts:[10,20,50,100],showSizeChanger:!0,onPageSizeChange:j=>{y(j).then()},onPageChange:D}}),e.jsxs(Te,{defaultValue:"0",style:{width:120},onChange:j=>{z(parseInt(j)),R(0,w,parseInt(j))},children:[e.jsx(Te.Option,{value:"0",children:"全部"}),e.jsx(Te.Option,{value:"1",children:"充值"}),e.jsx(Te.Option,{value:"2",children:"消费"}),e.jsx(Te.Option,{value:"3",children:"管理"}),e.jsx(Te.Option,{value:"4",children:"系统"})]})]})})},ps=()=>e.jsx(e.Fragment,{children:e.jsx(Fs,{})}),ms=()=>{const u=localStorage.getItem("chat_link");return e.jsx("iframe",{src:u,style:{width:"100%",height:"85vh",border:"none"}})},Yu=["amber","blue","cyan","green","grey","indigo","light-blue","lime","orange","pink","purple","red","teal","violet","yellow"];function gs(u){switch(u){case"IMAGINE":return e.jsx(_,{color:"blue",size:"large",children:"绘图"});case"UPSCALE":return e.jsx(_,{color:"orange",size:"large",children:"放大"});case"VARIATION":return e.jsx(_,{color:"purple",size:"large",children:"变换"});case"HIGH_VARIATION":return e.jsx(_,{color:"purple",size:"large",children:"强变换"});case"LOW_VARIATION":return e.jsx(_,{color:"purple",size:"large",children:"弱变换"});case"PAN":return e.jsx(_,{color:"cyan",size:"large",children:"平移"});case"DESCRIBE":return e.jsx(_,{color:"yellow",size:"large",children:"图生文"});case"BLEND":return e.jsx(_,{color:"lime",size:"large",children:"图混合"});case"SHORTEN":return e.jsx(_,{color:"pink",size:"large",children:"缩词"});case"REROLL":return e.jsx(_,{color:"indigo",size:"large",children:"重绘"});case"INPAINT":return e.jsx(_,{color:"violet",size:"large",children:"局部重绘-提交"});case"ZOOM":return e.jsx(_,{color:"teal",size:"large",children:"变焦"});case"CUSTOM_ZOOM":return e.jsx(_,{color:"teal",size:"large",children:"自定义变焦-提交"});case"MODAL":return e.jsx(_,{color:"green",size:"large",children:"窗口处理"});case"SWAP_FACE":return e.jsx(_,{color:"light-green",size:"large",children:"换脸"});default:return e.jsx(_,{color:"white",size:"large",children:"未知"})}}function xs(u){switch(u){case 1:return e.jsx(_,{color:"green",size:"large",children:"已提交"});case 21:return e.jsx(_,{color:"lime",size:"large",children:"等待中"});case 22:return e.jsx(_,{color:"orange",size:"large",children:"重复提交"});case 0:return e.jsx(_,{color:"yellow",size:"large",children:"未提交"});default:return e.jsx(_,{color:"white",size:"large",children:"未知"})}}function Es(u){switch(u){case"SUCCESS":return e.jsx(_,{color:"green",size:"large",children:"成功"});case"NOT_START":return e.jsx(_,{color:"grey",size:"large",children:"未启动"});case"SUBMITTED":return e.jsx(_,{color:"yellow",size:"large",children:"队列中"});case"IN_PROGRESS":return e.jsx(_,{color:"blue",size:"large",children:"执行中"});case"FAILURE":return e.jsx(_,{color:"red",size:"large",children:"失败"});case"MODAL":return e.jsx(_,{color:"yellow",size:"large",children:"窗口等待"});default:return e.jsx(_,{color:"white",size:"large",children:"未知"})}}const Cs=u=>{const n=new Date(u*1e3),c=n.getFullYear(),s=("0"+(n.getMonth()+1)).slice(-2),i=("0"+n.getDate()).slice(-2),r=("0"+n.getHours()).slice(-2),p=("0"+n.getMinutes()).slice(-2),C=("0"+n.getSeconds()).slice(-2);return`${c}-${s}-${i} ${r}:${p}:${C}`};function fs(u,n){if(!u||!n)return"N/A";const c=new Date(u),r=((new Date(n)-c)/1e3).toFixed(1),p=r>60?"red":"green";return e.jsxs(_,{color:p,size:"large",children:[r," 秒"]})}const js=()=>{const[u,n]=t.useState(!1),[c,s]=t.useState(""),i=[{title:"提交时间",dataIndex:"submit_time",render:(h,D,y)=>e.jsx("div",{children:Cs(h/1e3)})},{title:"花费时间",dataIndex:"finish_time",key:"finish_time",render:(h,D)=>fs(D.submit_time,h)},{title:"渠道",dataIndex:"channel_id",className:Ie()?"tableShow":"tableHiddle",render:(h,D,y)=>e.jsx("div",{children:e.jsxs(_,{color:Yu[parseInt(h)%Yu.length],size:"large",onClick:()=>{R(h)},children:[" ",h," "]})})},{title:"类型",dataIndex:"action",render:(h,D,y)=>e.jsx("div",{children:gs(h)})},{title:"任务ID",dataIndex:"mj_id",render:(h,D,y)=>e.jsx("div",{children:h})},{title:"提交结果",dataIndex:"code",className:Ie()?"tableShow":"tableHiddle",render:(h,D,y)=>e.jsx("div",{children:xs(h)})},{title:"任务状态",dataIndex:"status",className:Ie()?"tableShow":"tableHiddle",render:(h,D,y)=>e.jsx("div",{children:Es(h)})},{title:"进度",dataIndex:"progress",render:(h,D,y)=>e.jsx("div",{children:e.jsx(Tt,{stroke:D.status==="FAILURE"?"var(--semi-color-warning)":null,percent:h?parseInt(h.replace("%","")):0,showInfo:!0,"aria-label":"drawing progress"})})},{title:"结果图片",dataIndex:"image_url",render:(h,D,y)=>h?e.jsx(k,{onClick:()=>{W(h),b(!0)},children:"查看图片"}):"无"},{title:"Prompt",dataIndex:"prompt",render:(h,D,y)=>h?e.jsx(ee.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(h),n(!0)},children:h}):"无"},{title:"PromptEn",dataIndex:"prompt_en",render:(h,D,y)=>h?e.jsx(ee.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(h),n(!0)},children:h}):"无"},{title:"失败原因",dataIndex:"fail_reason",render:(h,D,y)=>h?e.jsx(ee.Text,{ellipsis:{showTooltip:!0},style:{width:100},onClick:()=>{s(h),n(!0)},children:h}):"无"}],[r,p]=t.useState([]),[C,A]=t.useState(!0),[o,F]=t.useState(1),[l,g]=t.useState(he),[w,O]=t.useState(0),I=Ie(),[z,b]=t.useState(!1),[J,S]=t.useState(!1),[U,W]=t.useState("");let q=new Date;const[Z,ue]=t.useState({channel_id:"",mj_id:"",start_timestamp:Le(q.getTime()/1e3-2592e3),end_timestamp:Le(q.getTime()/1e3+3600)}),{channel_id:V,mj_id:T,start_timestamp:x,end_timestamp:M}=Z;t.useState({quota:0,token:0});const H=(h,D)=>{ue(y=>({...y,[D]:h}))},E=h=>{for(let D=0;D<h.length;D++)h[D].timestamp2string=Le(h[D].created_at),h[D].key=""+h[D].id;p(h),g(h.length+he)},a=async h=>{A(!0);let D="",y=Date.parse(x),N=Date.parse(M);I?D=`/api/mj/?p=${h}&channel_id=${V}&mj_id=${T}&start_timestamp=${y}&end_timestamp=${N}`:D=`/api/mj/self/?p=${h}&mj_id=${T}&start_timestamp=${y}&end_timestamp=${N}`;const X=await $.get(D),{success:j,message:G,data:te}=X.data;if(j)if(h===0)E(te);else{let oe=[...r];oe.splice(h*he,te.length,...te),E(oe)}else f(G);A(!1)},d=r.slice((o-1)*he,o*he),m=h=>{F(h),h===Math.ceil(r.length/he)+1&&a(h-1).then(D=>{})},B=async()=>{F(1),await a(0)},R=async h=>{await ze(h)?Y("已复制："+h):fe.error({title:"无法复制到剪贴板，请手动复制",content:h})};return t.useEffect(()=>{B().then()},[w]),t.useEffect(()=>{localStorage.getItem("mj_notify_enabled")!=="true"&&S(!0)},[]),e.jsx(e.Fragment,{children:e.jsxs(re,{children:[I&&J?e.jsx(Xe,{type:"info",description:"当前未开启Midjourney回调，部分项目可能无法获得绘图结果，可在运营设置中开启。"}):e.jsx(e.Fragment,{}),e.jsx(L,{layout:"horizontal",style:{marginTop:10},children:e.jsxs(e.Fragment,{children:[e.jsx(L.Input,{field:"channel_id",label:"渠道 ID",style:{width:176},value:V,placeholder:"可选值",name:"channel_id",onChange:h=>H(h,"channel_id")}),e.jsx(L.Input,{field:"mj_id",label:"任务 ID",style:{width:176},value:T,placeholder:"可选值",name:"mj_id",onChange:h=>H(h,"mj_id")}),e.jsx(L.DatePicker,{field:"start_timestamp",label:"起始时间",style:{width:272},initValue:x,value:x,type:"dateTime",name:"start_timestamp",onChange:h=>H(h,"start_timestamp")}),e.jsx(L.DatePicker,{field:"end_timestamp",fluid:!0,label:"结束时间",style:{width:272},initValue:M,value:M,type:"dateTime",name:"end_timestamp",onChange:h=>H(h,"end_timestamp")}),e.jsx(L.Section,{children:e.jsx(k,{label:"查询",type:"primary",htmlType:"submit",className:"btn-margin-right",onClick:B,children:"查询"})})]})}),e.jsx(uu,{style:{marginTop:5},columns:i,dataSource:d,pagination:{currentPage:o,pageSize:he,total:l,pageSizeOpts:[10,20,50,100],onPageChange:m},loading:C}),e.jsx(fe,{visible:u,onOk:()=>n(!1),onCancel:()=>n(!1),closable:null,bodyStyle:{height:"400px",overflow:"auto"},width:800,children:e.jsx("p",{style:{whiteSpace:"pre-line"},children:c})}),e.jsx(It,{src:U,visible:z,onVisibleChange:h=>b(h)})]})})},ys=()=>e.jsx(e.Fragment,{children:e.jsx(js,{})});function Ds(u){switch(u){case 1:return e.jsx(_,{color:"green",size:"large",children:"按次计费"});case 0:return e.jsx(_,{color:"blue",size:"large",children:"按量计费"});default:return e.jsx(_,{color:"white",size:"large",children:"未知"})}}function Bs(u){return u?e.jsx(_,{color:"green",size:"large",children:"可用"}):e.jsx(Oe,{content:"您所在的分组不可用",children:e.jsx(_,{color:"red",size:"large",children:"不可用"})})}const As=()=>{const[u,n]=t.useState([]),c=t.useRef({isComposition:!1}),s=S=>{if(c.current.isComposition)return;n(S?[S]:[])},i=()=>{c.current.isComposition=!0},r=S=>{c.current.isComposition=!1;const U=S.target.value;n(U?[U]:[])},p=[{title:"可用性",dataIndex:"available",render:(S,U,W)=>Bs(S),sorter:(S,U)=>S.available-U.available},{title:e.jsxs(de,{children:[e.jsx("span",{children:"模型名称"}),e.jsx(se,{placeholder:"模糊搜索",style:{width:200},onCompositionStart:i,onCompositionEnd:r,onChange:s,showClear:!0})]}),dataIndex:"model_name",render:(S,U,W)=>e.jsx(e.Fragment,{children:e.jsx(_,{color:ru(S),size:"large",onClick:()=>{J(S)},children:S})}),onFilter:(S,U)=>U.model_name.includes(S),filteredValue:u},{title:"计费类型",dataIndex:"quota_type",render:(S,U,W)=>Ds(parseInt(S)),sorter:(S,U)=>S.quota_type-U.quota_type},{title:"模型倍率",dataIndex:"model_ratio",render:(S,U,W)=>e.jsx("div",{children:U.quota_type===0?S:"N/A"})},{title:"补全倍率",dataIndex:"completion_ratio",render:(S,U,W)=>{let q=parseFloat(S.toFixed(3));return e.jsx("div",{children:U.quota_type===0?q:"N/A"})}},{title:"模型价格",dataIndex:"model_price",render:(S,U,W)=>{let q=S;if(U.quota_type===0){let Z=U.model_ratio*2*U.group_ratio,ue=U.model_ratio*U.completion_ratio*2*U.group_ratio;q=e.jsxs(e.Fragment,{children:[e.jsxs(Cu,{children:["提示 $",Z," / 1M tokens"]}),e.jsx("br",{}),e.jsxs(Cu,{children:["补全 $",ue," / 1M tokens"]})]})}else{let Z=parseFloat(S)*U.group_ratio;q=e.jsxs(e.Fragment,{children:["模型价格：$",Z]})}return e.jsx("div",{children:q})}}],[C,A]=t.useState([]),[o,F]=t.useState(!0),[l,g]=t.useContext(Qe),[w,O]=t.useState(1),I=(S,U)=>{for(let W=0;W<S.length;W++)S[W].key=W,S[W].group_ratio=U;S.sort((W,q)=>W.quota_type-q.quota_type),S.sort((W,q)=>W.model_name.startsWith("gpt")&&!q.model_name.startsWith("gpt")?-1:!W.model_name.startsWith("gpt")&&q.model_name.startsWith("gpt")?1:W.model_name.localeCompare(q.model_name)),A(S)},z=async()=>{F(!0);let S="";S="/api/pricing";const U=await $.get(S),{success:W,message:q,data:Z,group_ratio:ue}=U.data;W?(O(ue),I(Z,ue)):f(q),F(!1)},b=async()=>{await z()},J=async S=>{await ze(S)?Y("已复制："+S):fe.error({title:"无法复制到剪贴板，请手动复制",content:S})};return t.useEffect(()=>{b().then()},[]),e.jsx(e.Fragment,{children:e.jsxs(re,{children:[l.user?e.jsx(Xe,{type:"info",description:`您的分组为：${l.user.group}，分组倍率为：${w}`}):e.jsx(Xe,{type:"warning",description:`您还未登陆，显示的价格为默认分组倍率: ${w}`}),e.jsx(uu,{style:{marginTop:5},columns:p,dataSource:C,loading:o,pagination:{pageSize:C.length,showSizeChanger:!1}})]})})},bs=()=>e.jsx(e.Fragment,{children:e.jsx(As,{})}),Ss=t.lazy(()=>Lu(()=>import("./index-YKtimYAl.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),ws=t.lazy(()=>Lu(()=>import("./index-BMU-KYoI.js"),__vite__mapDeps([7,1,8,2,3,4,5,6]))),vs=t.lazy(()=>Lu(()=>import("./index-CElmcdrh.js"),__vite__mapDeps([9,1,4,2,3,5,6])));function ks(){const[u,n]=t.useContext(Qe),c=()=>{let s=localStorage.getItem("user");if(s){let i=JSON.parse(s);n({type:"login",payload:i})}};return t.useEffect(()=>{c();let s=Bu();s&&(document.title=s);let i=du();if(i){let r=document.querySelector("link[rel~='icon']");r&&(r.href=i)}},[]),e.jsx(re,{children:e.jsx(re.Content,{children:e.jsxs(At,{children:[e.jsx(me,{path:"/",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Ss,{})})}),e.jsx(me,{path:"/channel",element:e.jsx(Ue,{children:e.jsx(Zn,{})})}),e.jsx(me,{path:"/channel/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Mu,{})})}),e.jsx(me,{path:"/channel/add",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Mu,{})})}),e.jsx(me,{path:"/token",element:e.jsx(Ue,{children:e.jsx(ts,{})})}),e.jsx(me,{path:"/redemption",element:e.jsx(Ue,{children:e.jsx(is,{})})}),e.jsx(me,{path:"/user",element:e.jsx(Ue,{children:e.jsx(En,{})})}),e.jsx(me,{path:"/user/edit/:id",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx($u,{})})}),e.jsx(me,{path:"/user/edit",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx($u,{})})}),e.jsx(me,{path:"/user/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Vn,{})})}),e.jsx(me,{path:"/login",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Sn,{})})}),e.jsx(me,{path:"/register",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Cn,{})})}),e.jsx(me,{path:"/reset",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(qn,{})})}),e.jsx(me,{path:"/oauth/github",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Kn,{})})}),e.jsx(me,{path:"/setting",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(Hn,{})})})}),e.jsx(me,{path:"/topup",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(ls,{})})})}),e.jsx(me,{path:"/log",element:e.jsx(Ue,{children:e.jsx(ps,{})})}),e.jsx(me,{path:"/detail",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(ws,{})})})}),e.jsx(me,{path:"/midjourney",element:e.jsx(Ue,{children:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(ys,{})})})}),e.jsx(me,{path:"/pricing",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(bs,{})})}),e.jsx(me,{path:"/about",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(vs,{})})}),e.jsx(me,{path:"/chat",element:e.jsx(t.Suspense,{fallback:e.jsx(je,{}),children:e.jsx(ms,{})})}),e.jsx(me,{path:"*",element:e.jsx(wn,{})})]})})})}localStorage.getItem("chat_link");const _s=()=>{const[u,n]=t.useContext(Qe);let c=Pe();const[s,i]=t.useState(!1);Bu(),du();const r=new Date,p=r.getMonth()===0&&r.getDate()===1||r.getMonth()===1&&r.getDate()>=9&&r.getDate()<=24;async function C(){i(!1),await $.get("/api/user/logout"),Y("注销成功!"),n({type:"logout"}),localStorage.removeItem("user"),c("/login")}const A=()=>{Su.init("root",{}),Su.start(),setTimeout(()=>{Su.stop(),setTimeout(()=>{window.location.reload()},1e4)},3e3)},o=Ft(),F=vn();return t.useEffect(()=>{o==="dark"&&document.body.setAttribute("theme-mode","dark"),p&&console.log("Happy New Year!")},[]),e.jsx(e.Fragment,{children:e.jsx(re,{children:e.jsx("div",{style:{width:"100%"},children:e.jsx(Ye,{mode:"horizontal",renderWrapper:({itemElement:l,isSubNav:g,isInSubNav:w,props:O})=>{const I={about:"/about",login:"/login",register:"/register"};return e.jsx(iu,{style:{textDecoration:"none"},to:I[O.itemKey],children:l})},selectedKeys:[],onSelect:l=>{},footer:e.jsxs(e.Fragment,{children:[p&&e.jsx(He,{position:"bottomRight",render:e.jsx(He.Menu,{children:e.jsx(He.Item,{onClick:A,children:"Happy New Year!!!"})}),children:e.jsx(Ye.Item,{itemKey:"new-year",text:"🏮"})}),e.jsx(Ye.Item,{itemKey:"about",icon:e.jsx(Pt,{})}),e.jsx(Tu,{checkedText:"🌞",size:"large",checked:o==="dark",uncheckedText:"🌙",onChange:l=>{F(l)}}),u.user?e.jsx(e.Fragment,{children:e.jsxs(He,{position:"bottomRight",render:e.jsx(He.Menu,{children:e.jsx(He.Item,{onClick:C,children:"退出"})}),children:[e.jsx(Ou,{size:"small",color:ru(u.user.username),style:{margin:4},children:u.user.username[0]}),e.jsx("span",{children:u.user.username})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Ye.Item,{itemKey:"login",text:"登录",icon:e.jsx(tt,{})}),e.jsx(Ye.Item,{itemKey:"register",text:"注册",icon:e.jsx(nt,{})})]})]})})})})})};var Ts={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Is=()=>{Bu();const[u,n]=t.useState(ln());let c=5;const s=()=>{let i=localStorage.getItem("footer_html");i&&n(i)};return t.useEffect(()=>{const i=setInterval(()=>{if(c<=0){clearInterval(i);return}c--,s()},200);return()=>clearTimeout(i)},[]),e.jsx(re,{children:e.jsx(re.Content,{style:{textAlign:"center"},children:u?e.jsx("div",{className:"custom-footer",dangerouslySetInnerHTML:{__html:u}}):e.jsxs("div",{className:"custom-footer",children:[e.jsxs("a",{href:"https://github.com/Calcium-Ion/new-api",target:"_blank",rel:"noreferrer",children:["New API ",Ts.VITE_REACT_APP_VERSION," "]}),"由"," ",e.jsx("a",{href:"https://github.com/Calcium-Ion",target:"_blank",rel:"noreferrer",children:"Calcium-Ion"})," ","开发，基于"," ",e.jsx("a",{href:"https://github.com/songquanpeng/one-api",target:"_blank",rel:"noreferrer",children:"One API v0.5.4"})," ","，本项目根据"," ",e.jsx("a",{href:"https://opensource.org/licenses/mit-license.php",children:"MIT 许可证"})," ","授权"]})})})},Ps=(u,n)=>{switch(n.type){case"set":return{...u,status:n.payload};case"unset":return{...u,status:void 0};default:return u}},gt={status:void 0},xt=ou.createContext({state:gt,dispatch:()=>null}),$s=({children:u})=>{const[n,c]=ou.useReducer(Ps,gt);return e.jsx(xt.Provider,{value:[n,c],children:u})},Ms=()=>{t.useContext(Qe);const[u,n]=t.useContext(xt),c=we()||localStorage.getItem("default_collapse_sidebar")==="true";Pe();const[s,i]=t.useState(["home"]),r=Bu(),p=du(),[C,A]=t.useState(c),o={home:"/",channel:"/channel",token:"/token",redemption:"/redemption",topup:"/topup",user:"/user",log:"/log",midjourney:"/midjourney",setting:"/setting",about:"/about",chat:"/chat",detail:"/detail",pricing:"/pricing"},F=t.useMemo(()=>[{text:"首页",itemKey:"home",to:"/",icon:e.jsx($t,{})},{text:"渠道",itemKey:"channel",to:"/channel",icon:e.jsx(Mt,{}),className:Ie()?"semi-navigation-item-normal":"tableHiddle"},{text:"聊天",itemKey:"chat",to:"/chat",icon:e.jsx(Rt,{}),className:localStorage.getItem("chat_link")?"semi-navigation-item-normal":"tableHiddle"},{text:"令牌",itemKey:"token",to:"/token",icon:e.jsx(tt,{})},{text:"兑换码",itemKey:"redemption",to:"/redemption",icon:e.jsx(Ot,{}),className:Ie()?"semi-navigation-item-normal":"tableHiddle"},{text:"钱包",itemKey:"topup",to:"/topup",icon:e.jsx(zt,{})},{text:"模型价格",itemKey:"pricing",to:"/pricing",icon:e.jsx(Lt,{})},{text:"用户管理",itemKey:"user",to:"/user",icon:e.jsx(nt,{}),className:Ie()?"semi-navigation-item-normal":"tableHiddle"},{text:"日志",itemKey:"log",to:"/log",icon:e.jsx(Nt,{})},{text:"数据看板",itemKey:"detail",to:"/detail",icon:e.jsx(Ut,{}),className:localStorage.getItem("enable_data_export")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"绘图",itemKey:"midjourney",to:"/midjourney",icon:e.jsx(Wt,{}),className:localStorage.getItem("enable_drawing")==="true"?"semi-navigation-item-normal":"tableHiddle"},{text:"设置",itemKey:"setting",to:"/setting",icon:e.jsx(Gt,{})}],[localStorage.getItem("enable_data_export"),localStorage.getItem("enable_drawing"),localStorage.getItem("chat_link"),Ie()]),l=async()=>{const g=await $.get("/api/status");if(g===void 0)return;const{success:w,data:O}=g.data;w?(n({type:"set",payload:O}),An(O)):f("无法正常连接至服务器！")};return t.useEffect(()=>{l().then(()=>{A(we()||localStorage.getItem("default_collapse_sidebar")==="true")});let g=window.location.pathname.split("/")[1];g===""&&(g="home"),i([g])},[]),e.jsx(e.Fragment,{children:e.jsx(re,{children:e.jsx("div",{style:{height:"100%"},children:e.jsx(Ye,{style:{maxWidth:200},defaultIsCollapsed:we()||localStorage.getItem("default_collapse_sidebar")==="true",isCollapsed:C,onCollapseChange:g=>{A(g)},selectedKeys:s,renderWrapper:({itemElement:g,isSubNav:w,isInSubNav:O,props:I})=>e.jsx(iu,{style:{textDecoration:"none"},to:o[I.itemKey],children:g}),items:F,onSelect:g=>{i([g.itemKey])},header:{logo:e.jsx("img",{src:p,alt:"logo",style:{marginRight:"0.75em"}}),text:r},children:e.jsx(Ye.Footer,{collapseButton:!0})})})})})},Rs=Pu.createRoot(document.getElementById("root")),{Sider:Os,Content:zs,Header:Ls}=re;Rs.render(e.jsx(ou.StrictMode,{children:e.jsx($s,{children:e.jsx(jn,{children:e.jsx(bt,{children:e.jsx(kn,{children:e.jsxs(re,{children:[e.jsx(Os,{children:e.jsx(Ms,{})}),e.jsxs(re,{children:[e.jsx(Ls,{children:e.jsx(_s,{})}),e.jsx(zs,{style:{padding:"24px"},children:e.jsx(ks,{})}),e.jsx(re.Footer,{children:e.jsx(Is,{})})]}),e.jsx(Vt,{})]})})})})})}));export{$ as A,xt as S,f as a,ju as b,qs as c,ge as d,Vs as g,Ie as i,e as j,Qs as m,Ks as r,Gu as s,Le as t};
